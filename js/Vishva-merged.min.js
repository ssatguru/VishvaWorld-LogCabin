var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e){var i=this;this._animSelect=null,this._vishva=e;var n=document.getElementById("animSkelChange"),s=document.getElementById("animSkelClone"),a=document.getElementById("animSkelView"),o=document.getElementById("animRest"),r=document.getElementById("animRangeName"),l=document.getElementById("animRangeStart"),h=document.getElementById("animRangeEnd"),u=document.getElementById("animRangeMake");this._animSkelList=document.getElementById("animSkelList"),n.onclick=function(e){i._vishva.changeSkeleton(i._animSkelList.selectedOptions[0].value)?i.update():t.DialogMgr.showAlertDiag("Error: unable to switch")},s.onclick=function(e){i._vishva.cloneChangeSkeleton(i._animSkelList.selectedOptions[0].value)?i.update():t.DialogMgr.showAlertDiag("Error: unable to clone and switch")},a.onclick=function(t){i._vishva.toggleSkelView()},o.onclick=function(t){i._vishva.animRest()},u.onclick=function(e){var n=r.value,s=parseInt(l.value);isNaN(s)&&t.DialogMgr.showAlertDiag("from frame is not a number");var a=parseInt(h.value);isNaN(a)&&t.DialogMgr.showAlertDiag("to frame is not a number"),i._vishva.createAnimRange(n,s,a),i._refreshAnimSelect()},this._animSelect=document.getElementById("animList"),this._animSelect.onchange=function(t){var e=i._animSelect.value;if(null!=e){var n=i._skel.getAnimationRange(e);document.getElementById("animFrom").innerText=new Number(n.from).toString(),document.getElementById("animTo").innerText=new Number(n.to).toString()}return!0},this._animRate=document.getElementById("animRate"),this._animLoop=document.getElementById("animLoop"),document.getElementById("playAnim").onclick=function(t){if(null==i._skel)return!0;var e=i._animSelect.value,n=i._animRate.value;return null!=e&&i._vishva.playAnimation(e,n,i._animLoop.checked),!0},document.getElementById("stopAnim").onclick=function(t){return null==i._skel||(i._vishva.stopAnimation(),!0)},document.getElementById("remAnim").onclick=function(t){if(null==i._skel)return!0;var e=i._animSelect.value;return i._vishva.delAnimRange(e,!1),i._refreshAnimSelect(),!0},document.getElementById("delAnim").onclick=function(t){if(null==i._skel)return!0;var e=i._animSelect.value;return i._vishva.delAnimRange(e,!0),i._refreshAnimSelect(),!0}}return e.prototype.update=function(){this._skel=this._vishva.getSkeleton();var t;null==this._skel?t="NO SKELETON":(t=this._skel.name.trim(),""===t&&(t="NO NAME"),t=t+" ("+this._skel.id+")"),document.getElementById("skelName").innerText=t,this._refreshAnimSelect(),this._refreshAnimSkelList()},e.prototype._refreshAnimSelect=function(){for(var t=this._animSelect.children,e=0|t.length,i=e-1;i>=0;i--)t[i].remove();var n=this._vishva.getAnimationRanges();if(null!=n){for(var s,a=0,o=n;a<o.length;a++){var r=o[a];null!=r&&(s=document.createElement("option"),s.value=r.name,s.innerText=r.name,this._animSelect.appendChild(s))}null!=n[0]?(document.getElementById("animFrom").innerText=new Number(n[0].from).toString(),document.getElementById("animTo").innerText=new Number(n[0].to).toString()):(document.getElementById("animFrom").innerText="",document.getElementById("animTo").innerText="")}else document.getElementById("animFrom").innerText="",document.getElementById("animTo").innerText=""},e.prototype._refreshAnimSkelList=function(){for(var t=this._animSkelList.children,e=0|t.length,i=e-1;i>=0;i--)t[i].remove();for(var n,s=this._vishva.getSkeltons(),a=0,o=s;a<o.length;a++){var r=o[a];n=document.createElement("option"),n.value=r.id+"-"+r.name,n.innerText=r.name+" ("+r.id+")",this._animSkelList.appendChild(n)}},e}();t.AnimationUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i,n,s,a){var o=this;this.inner0="<input class='colorInputValue' title='enter color in hex #hhhhhh'  type='text' style='width:100%;height:32px;border-width:1px;border-style:solid;' ></input>",this.inner1="<input class='colorInput' type='text' style='width:100%;height:32px;border-width:1px;border-style:solid;cursor: pointer' readonly></input>",this.inner2="<div class='colorDiag' style='align-content: center'><div  class='colorPicker cp-fancy'></div></div>",this.hexColor=n;var r=document.getElementById(i);r.innerHTML=this.inner0.concat(this.inner1).concat(this.inner2),this.colorInputValue=r.getElementsByClassName("colorInputValue")[0],this.colorInputValue.value=this.hexColor,this.colorInputValue.onchange=function(){console.log("blur = changing color value"),o.hexColor=o.colorInputValue.value,o.colorInput.style.backgroundColor=o.hexColor,o.cp.setHex(o.hexColor),a(o.hexColor,null,null)},this.colorInput=r.getElementsByClassName("colorInput")[0],this.colorInput.style.backgroundColor=this.hexColor,this.colorInput.onclick=function(){o.vDiag.open(),o.cp.setHex(o.hexColor)};var l=r.getElementsByClassName("colorDiag")[0],h=l.getElementsByClassName("colorPicker")[0];this.cp=new ColorPicker(h,function(t,e,i){o.hexColor=t,o.colorInput.style.backgroundColor=t,o.colorInputValue.value=t,a(t,e,i)}),this.vDiag=new t.VDialog(l,e,s)}return e.prototype.open=function(t){this.vDiag.open(),this.setColor(t)},e.prototype.setColor=function(t){this.hexColor=t,this.cp.setHex(t),this.colorInput.style.backgroundColor=t,this.colorInputValue.value=t},e.prototype.getColor=function(){return this.hexColor},e}();t.ColorPickerDiag=e;!function(){function t(){this.r=0,this.g=0,this.b=0}}()}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i,n,s,a,o,r){void 0===s&&(s=0),void 0===o&&(o=0),void 0===r&&(r=!1);var l=this;this._height=0,this._minimized=!1,this._fixingDragIssue=!1,null!=a&&""!=a||(a="auto"),this._height=a,e instanceof HTMLDivElement?this._diag=$(e):this._diag=$("#"+e);var h={title:i,autoOpen:!1,resizable:!1,position:n,height:a,closeText:"",closeOnEscape:!1,modal:r,open:function(t,e){l._fixingDragIssue?l._fixingDragIssue=!1:null!=l._onOpen&&l._onOpen()},close:function(){l._fixingDragIssue?l._fixingDragIssue=!1:null!=l._onClose&&l._onClose()},dragStop:function(t,e){l._fixingDragIssue=!0,l._diag.dialog("close"),l._diag.dialog("open"),l._minimized&&l.minimize()}};this._diag.dialog(h),0!=o&&this._diag.dialog("option","minWidth",o),0!=s&&this._diag.dialog("option","width",s),this.jpo=n,t.DialogMgr.dialogs.push(this);var u=$("<span id='vdMinimizer' class='ui-icon ui-icon-circle-minus'></span>"),c=this._diag.parent().children(".ui-dialog-titlebar").children(".ui-dialog-title");c.before(u),u.click(function(){l._minimized?(u.removeClass("ui-icon-circle-plus"),u.addClass("ui-icon-circle-minus"),l.maximize()):(u.removeClass("ui-icon-circle-minus"),u.addClass("ui-icon-circle-plus"),l.minimize())}),c.dblclick(function(){l.close()})}return e.prototype.onClose=function(t){this._onClose=t},e.prototype.onOpen=function(t){this._onOpen=t},e.prototype.setModal=function(t){this._diag.dialog("option","modal",t)},e.prototype.setResizable=function(t){this._diag.dialog("option","resizable",t)},e.prototype.open=function(){this._diag.dialog("open"),this._minimized&&this.minimize()},e.prototype.close=function(){this._diag.dialog("close")},e.prototype.minimize=function(){this._minimized=!0,this._diag.dialog("option","position",null),this._diag.dialog("option","height",0),this._diag.hide()},e.prototype.maximize=function(){this._minimized=!1,this._diag.dialog("option","height",this._height),this._diag.show()},e.prototype.isOpen=function(){return this._diag.dialog("isOpen")},e.prototype.toggle=function(){this.isOpen()?this.close():this.open()},e.prototype.position=function(){this._diag.dialog("option","position",this.jpo)},e.prototype.setButtons=function(t){this._diag.dialog("option","buttons",t)},e}();t.VDialog=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(){}return e.createAlertDiag=function(){null==this._alertDialog&&(this._alertDialog=new t.VDialog("alertDiv","Info",e.center,"","",200))},e.showAlertDiag=function(t){this._alertDiv.innerHTML="<h3>"+t+"</h3>",this._alertDialog.open()},e.dialogs=new Array,e.center={at:"center center",my:"center center",of:"#vCanvas",within:"#vCanvas",collision:"fit"},e.centerBottom={at:"center bottom",my:"center bottom",within:"#vCanvas",of:"#vCanvas",collision:"fit"},e.leftCenter={at:"left center",my:"left center",of:"#vCanvas",within:"#vCanvas",collision:"fit"},e.rightCenter={at:"right center",my:"right center",of:"#vCanvas",within:"#vCanvas",collision:"fit"},e.rightTop={at:"right top",my:"right top",of:"#vCanvas",within:"#vCanvas",collision:"fit"},e._alertDiv=document.getElementById("alertDiv"),e}();t.DialogMgr=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i,n){var s=this;this._vishva=e,this._vishvaGUI=n,this._addInternalAssetUI=i;var a=$("#sunPos"),o=$("#light"),r=$("#shade"),l=$("#fog"),h=$("#fov");a.slider(this._sliderOptions(0,180,this._vishva.getSunPos())),o.slider(this._sliderOptions(0,100,100*this._vishva.getLight())),r.slider(this._sliderOptions(0,100,100*this._vishva.getShade())),l.slider(this._sliderOptions(0,100,100*this._vishva.getFog()));new t.ColorPickerDiag("fog color","fogCol",this._vishva.getFogColor(),t.DialogMgr.centerBottom,function(t,e,i){s._vishva.setFogColor(t)});h.slider(this._sliderOptions(0,180,this._vishva.getFov())),document.getElementById("envSnow").onclick=function(t){s._vishva.toggleSnow()},document.getElementById("envRain").onclick=function(t){s._vishva.toggleRain()},document.getElementById("skyButton").onclick=function(t){return s._addInternalAssetUI.toggleAssetDiag("skyboxes"),!0},document.getElementById("envSea").onclick=function(t){(null==s._vishva.waterMesh||s._vishva.waterMesh.isDisposed())&&s._vishva.createWater()},document.getElementById("trnButton").onclick=function(t){return s._vishva.selectGround(),n.showPropDiag(),!0};new t.ColorPickerDiag("ambient color","ambCol",this._vishva.getAmbientColor(),t.DialogMgr.centerBottom,function(t,e,i){s._vishva.setAmbientColor(t)});this._envDiag=new t.VDialog("envDiv","Environment",t.DialogMgr.rightCenter,"","",350)}return e.prototype._sliderOptions=function(t,e,i){var n=this,s={};return s.min=t,s.max=e,s.value=i,s.slide=function(t,e){return n._handleSlide(t,e)},s},e.prototype._handleSlide=function(t,e){var i=t.target.id;if("fov"===i)this._vishva.setFov(e.value);else if("sunPos"===i)this._vishva.setSunPos(e.value);else{var n=e.value/100;"light"===i?this._vishva.setLight(n):"shade"===i?this._vishva.setShade(n):"fog"===i&&(console.log(n),this._vishva.setFog(n/100))}return!0},e.prototype.toggle=function(){this._envDiag.toggle()},e}();t.EnvironmentUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i){var n=this;this._vishva=e,this._vishvaGUI=i,this._genName=document.getElementById("genName"),this._genName.onchange=function(){n._vishva.setName(n._genName.value)},this._genSpace=document.getElementById("genSpace"),this._genSpace.onchange=function(){var e=n._vishva.setSpace(n._genSpace.value);null!==e&&(t.DialogMgr.showAlertDiag(e),n._genSpace.value=n._vishva.getSpace())},void 0===this._transRefresh&&(this._transRefresh=document.getElementById("transRefresh"),this._transRefresh.onclick=function(){return n._updateTransform(),!1}),void 0===this._transBake&&(this._transBake=document.getElementById("transBake"),this._transBake.onclick=function(){return n._vishva.bakeTransforms(),n._updateTransform(),!1}),this._genOperTrans=document.getElementById("operTrans"),this._genOperRot=document.getElementById("operRot"),this._genOperScale=document.getElementById("operScale"),this._genOperFocus=document.getElementById("operFocus"),this._genOperTrans.onclick=function(){n._vishva.setTransOn()},this._genOperRot.onclick=function(){n._vishva.setRotOn()},this._genOperScale.onclick=function(){n._vishva.setScaleOn(),n._vishva.isSpaceLocal()||t.DialogMgr.showAlertDiag("note that scaling doesnot work with global axis")},this._genOperFocus.onclick=function(){n._vishva.setFocusOnMesh()},this._genLocX=document.getElementById("loc.x"),this._genLocX.onchange=function(){n._vishva.setLocation(Number(n._genLocX.value),Number(n._genLocY.value),Number(n._genLocZ.value))},this._genLocY=document.getElementById("loc.y"),this._genLocY.onchange=function(){n._vishva.setLocation(Number(n._genLocX.value),Number(n._genLocY.value),Number(n._genLocZ.value))},this._genLocZ=document.getElementById("loc.z"),this._genLocZ.onchange=function(){n._vishva.setLocation(Number(n._genLocX.value),Number(n._genLocY.value),Number(n._genLocZ.value))},this._genRotX=document.getElementById("rot.x"),this._genRotX.onchange=function(){n._vishva.setRotation(Number(n._genRotX.value),Number(n._genRotY.value),Number(n._genRotZ.value))},this._genRotY=document.getElementById("rot.y"),this._genRotY.onchange=function(){n._vishva.setRotation(Number(n._genRotX.value),Number(n._genRotY.value),Number(n._genRotZ.value))},this._genRotZ=document.getElementById("rot.z"),this._genRotZ.onchange=function(){n._vishva.setRotation(Number(n._genRotX.value),Number(n._genRotY.value),Number(n._genRotZ.value))},this._genScaleX=document.getElementById("scl.x"),this._genScaleX.onchange=function(){n._vishva.setScale(Number(n._genScaleX.value),Number(n._genScaleY.value),Number(n._genScaleZ.value))},this._genScaleY=document.getElementById("scl.y"),this._genScaleY.onchange=function(){n._vishva.setScale(Number(n._genScaleX.value),Number(n._genScaleY.value),Number(n._genScaleZ.value))},this._genScaleZ=document.getElementById("scl.z"),this._genScaleZ.onchange=function(){n._vishva.setScale(Number(n._genScaleX.value),Number(n._genScaleY.value),Number(n._genScaleZ.value))},this._genSnapTrans=document.getElementById("snapTrans"),this._genSnapTrans.onchange=function(){var e=n._vishva.snapTrans(n._genSnapTrans.checked);null!=e&&(t.DialogMgr.showAlertDiag(e),n._genSnapTrans.checked=!1)},this._genSnapRot=document.getElementById("snapRot"),this._genSnapRot.onchange=function(){var e=n._vishva.snapRot(n._genSnapRot.checked);null!=e&&(t.DialogMgr.showAlertDiag(e),n._genSnapRot.checked=!1)},this._genSnapScale=document.getElementById("snapScale"),this._genSnapScale.onchange=function(){var e=n._vishva.snapScale(n._genSnapScale.checked);null!=e&&(t.DialogMgr.showAlertDiag(e),n._genSnapScale.checked=!1)},this._genSnapTransValue=document.getElementById("snapTransValue"),this._genSnapTransValue.onchange=function(){n._vishva.setSnapTransValue(Number(n._genSnapTransValue.value))},this._genSnapRotValue=document.getElementById("snapRotValue"),this._genSnapRotValue.onchange=function(){n._vishva.setSnapRotValue(Number(n._genSnapRotValue.value))},this._genSnapScaleValue=document.getElementById("snapScaleValue"),this._genSnapScaleValue.onchange=function(){n._vishva.setSnapScaleValue(Number(n._genSnapScaleValue.value))},this._genDisable=document.getElementById("genDisable"),this._genDisable.onchange=function(){n._vishva.disableIt(n._genDisable.checked)},this._genColl=document.getElementById("genColl"),this._genColl.onchange=function(){n._vishva.enableCollision(n._genColl.checked)},this._genVisi=document.getElementById("genVisi"),this._genVisi.onchange=function(){n._vishva.makeVisibile(n._genVisi.checked)};var s=document.getElementById("undo"),a=document.getElementById("redo"),o=document.getElementById("parentMesh"),r=document.getElementById("removeParent"),l=document.getElementById("removeChildren"),h=document.getElementById("cloneMesh"),u=document.getElementById("instMesh"),c=document.getElementById("mergeMesh"),p=document.getElementById("subMesh"),d=document.getElementById("interMesh"),g=document.getElementById("downMesh"),m=document.getElementById("delMesh"),v=document.getElementById("swAv"),f=document.getElementById("swGnd"),y=document.getElementById("sNa"),_=document.getElementById("addParticles");s.onclick=function(t){return n._vishva.undo(),!1},a.onclick=function(t){return n._vishva.redo(),!1},o.onclick=function(e){var i=n._vishva.makeParent();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},r.onclick=function(e){var i=n._vishva.removeParent();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},l.onclick=function(e){var i=n._vishva.removeChildren();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},h.onclick=function(e){var i=n._vishva.clone_mesh();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},u.onclick=function(e){var i=n._vishva.instance_mesh();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},c.onclick=function(e){var i=n._vishva.mergeMeshes();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},p.onclick=function(e){var i=n._vishva.csgOperation("subtract");return null!=i&&t.DialogMgr.showAlertDiag(i),!1},d.onclick=function(e){var i=n._vishva.csgOperation("intersect");return null!=i&&t.DialogMgr.showAlertDiag(i),!1},g.onclick=function(e){var i=n._vishva.saveAsset();return null==i?(t.DialogMgr.showAlertDiag("No Mesh Selected"),!0):(null==n._downloadDialog&&n._createDownloadDiag(),n._downloadLink.href=i,n._downloadDialog.dialog("open"),!1)},m.onclick=function(e){var i=n._vishva.delete_mesh();return null!=i&&t.DialogMgr.showAlertDiag(i),!1},v.onclick=function(e){var i=n._vishva.switchAvatar();return null!=i&&t.DialogMgr.showAlertDiag(i),!0},f.onclick=function(e){var i=n._vishva.switchGround();return null!=i&&t.DialogMgr.showAlertDiag(i),!0},y.onclick=function(e){return null==n._snaUI&&(n._snaUI=new t.SnaUI(n._vishva,n._vishvaGUI)),n._snaUI.show_sNaDiag(),!0},_.onclick=function(e){return null==n._addInternalAssetUI&&(n._addInternalAssetUI=new t.InternalAssetsUI(n._vishva)),n._addInternalAssetUI.toggleAssetDiag("particles"),!0}}return e.prototype.update=function(){this._genName.value=this._vishva.getName(),this._genSpace.value=this._vishva.getSpace(),this._updateTransform(),this._genDisable.checked=this._vishva.isDisabled(),this._genColl.checked=this._vishva.isCollideable(),this._genVisi.checked=this._vishva.isVisible()},e.prototype._updateTransform=function(){var t=this._vishva.getLocation(),e=this._vishva.getRotation(),i=this._vishva.getScale();document.getElementById("loc.x").value=this._toString(t.x),document.getElementById("loc.y").value=this._toString(t.y),document.getElementById("loc.z").value=this._toString(t.z),document.getElementById("rot.x").value=this._toString(e.x),document.getElementById("rot.y").value=this._toString(e.y),document.getElementById("rot.z").value=this._toString(e.z),document.getElementById("scl.x").value=this._toString(i.x),document.getElementById("scl.y").value=this._toString(i.y),document.getElementById("scl.z").value=this._toString(i.z)},e.prototype._createDownloadDiag=function(){this._downloadLink=document.getElementById("downloadAssetLink"),this._downloadDialog=$("#saveAssetDiv"),this._downloadDialog.dialog(),this._downloadDialog.dialog("close")},e.prototype._toString=function(t){return new Number(t).toFixed(2).toString()},e}();t.GeneralUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=BABYLON.Vector2,n=BABYLON.Vector3,s=BABYLON.Color3,a=BABYLON.MeshBuilder,o=BABYLON.Tags,r=function(){function r(s){var a=this;this._vishva=s;var o=s.ground;this._grndID=new e.VInputText("grndID",o.name),this._grndHM=new e.VFileInput("grndHM",null,"Height Map Image",e.DialogMgr.centerBottom,t.Vishva.vishvaFiles,".bmp$|.png$|.tga$.jpg$",!0),this._grndW=new e.VInputNumber("grndW",o._width),this._grndL=new e.VInputNumber("grndL",o._height),this._grndS=new e.VInputNumber("grndS",o.subdivisions),this._grndminH=new e.VInputNumber("grndminH"),this._grndmaxH=new e.VInputNumber("grndmaxH"),this._grndUVOffset=new e.VInputVector2("grndUVOffset",new i(0,0)),this._grndUVScale=new e.VInputVector2("grndUVScale",new i(1,1)),this._grndFC=new e.VInputVector3("grndFC",new n(.3,.59,.11)),this._grndUpdate=document.getElementById("grndUpdate"),this._grndUpdate.onclick=function(){a.updateGround()}}return r.prototype.update=function(){var t=this._vishva.ground;return this._grndID.setValue(t.name),!0},r.prototype.updateGround=function(){var t=this;console.log("updateGround");var e=this._vishva.ground,i=this._grndFC.getValue(),n=new s(i.x,i.y,i.z);a.CreateGroundFromHeightMap(this._grndID.getValue(),this._grndHM.getValue(),{width:this._grndW.getValue(),height:this._grndL.getValue(),minHeight:this._grndminH.getValue(),maxHeight:this._grndmaxH.getValue(),subdivisions:this._grndS.getValue(),colorFilter:n,updatable:!1,onReady:function(i){i.material=e.material,i.checkCollisions=!0,i.isPickable=!1,o.AddTagsTo(i,"Vishva.ground Vishva.internal"),i.receiveShadows=!0,i.freezeWorldMatrix(),t._vishva.ground=i,t._vishva.switchEditControl(i),t._adjustHts(i,e),e.dispose()}},this._vishva.scene)},r.prototype._adjustHts=function(t,e){for(var i=this._vishva.scene.meshes,n=0,s=i;n<s.length;n++){var a=s[n];if(a!=t&&(a!=e&&null==a.parent)){var o=a.position.x,r=a.position.y,l=a.position.z,h=r-e.getHeightAtCoordinates(o,l);a.position.y=t.getHeightAtCoordinates(o,l)+h}}var u=this._vishva.mainCamera,c=u.position.x,p=u.position.y,d=u.position.z,g=p-e.getHeightAtCoordinates(c,d);u.position.y=t.getHeightAtCoordinates(c,d)+g},r}();e.GrndDimUI=r}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e){var i=this;this._ready=!1,this._vishva=e,document.getElementById("genSPSParms").onclick=function(){i._updateUI()?i._ready=!0:i._ready=!1,n.disabled=!i._ready};var n=document.getElementById("genSPS");n.disabled=this._ready,n.onclick=function(){i._updateSpreadParms()?i._ready=!0:i._ready=!1,n.disabled=!i._ready},this._spsList=new t.VInputSelect("spsList",this._vishva.getGrndSPSList()),this._spsList.onSelect=function(t){i._updateUI(t)},this._spsName=document.getElementById("spsName"),this._spsMesh=document.getElementById("spsMesh"),this._spsSeed=new t.VInputNumber("spsSeed"),this.spsStep=new t.VInputNumber("spsStep"),this.sprdCon1=new t.VInputVector2("sprdCon1"),this.sprdCon2=new t.VInputVector2("sprdCon2"),this.posMin=new t.VInputVector3("posMin"),this.posMax=new t.VInputVector3("posMax"),this.sclMin=new t.VInputVector3("sclMin"),this.sclMax=new t.VInputVector3("sclMax"),this.rotMin=new t.VInputVector3("rotMin"),this.rotMax=new t.VInputVector3("rotMax"),this.posRange=new t.VRange("posRange",0,1,.1,.5),this.sclRange=new t.VRange("sclRange",0,1,.1,.5),this.rotRange=new t.VRange("rotRange",0,180,1,5)}return e.prototype._updateUI=function(e){var i;if(e){var n=void 0;if(null==(n=this._vishva.getGrndSPSbyID(e)))return void t.DialogMgr.showAlertDiag("could not find gound sps with id : "+e);i=n.getSpreadDtls(),this._grndSPS=n}else{var n=this._vishva.createGrndSPS();if(!(n instanceof Object))return t.DialogMgr.showAlertDiag(n),!1;i=n.getSpreadDtls(),this._grndSPS=n}return this._spsName.innerText=this._grndSPS.name+"("+this._grndSPS.id+")",this._spsMesh.innerText=this._grndSPS.mesh.name+"("+this._grndSPS.mesh.id+")",this._spsSeed.setValue(i.seed),this.spsStep.setValue(i.step),this.sprdCon1.setValue(i.sprdCon1),this.sprdCon2.setValue(i.sprdCon2),this.posMin.setValue(i.posMin),this.posMax.setValue(i.posMax),this.sclMin.setValue(i.sclMin),this.sclMax.setValue(i.sclMax),this.rotMin.setValue(i.rotMin),this.rotMax.setValue(i.rotMax),this.posRange.setValue(i.posRange),this.sclRange.setValue(i.sclRange),this.rotRange.setValue(i.rotRange),!0},e.prototype._updateSpreadParms=function(){var e=this.sprdCon2.getValue(),i=this.sprdCon1.getValue();if(e.x==i.x)return t.DialogMgr.showAlertDiag("corners x co-ordinates cannot be the same"),!1;if(e.y==i.y)return t.DialogMgr.showAlertDiag("corners y co-ordinates cannot be the same"),!1;var n=this._grndSPS.getSpreadDtls();return n.seed=this._spsSeed.getValue(),n.step=this.spsStep.getValue(),n.sprdCon1=this.sprdCon1.getValue(),n.sprdCon2=this.sprdCon2.getValue(),n.posMin=this.posMin.getValue(),n.posMax=this.posMax.getValue(),n.sclMin=this.sclMin.getValue(),n.sclMax=this.sclMax.getValue(),n.rotMin=this.rotMin.getValue(),n.rotMax=this.rotMax.getValue(),n.posRange=this.posRange.getValue(),n.sclRange=this.sclRange.getValue(),n.rotRange=this.rotRange.getValue(),this._grndSPS.setSpreadDtls(n),this._grndSPS.generate(),this._vishva.updateSPSArray(this._grndSPS),!0},e}();t.GrndSPSUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i){var n=this;this._grndDiag=null,this._fixingDragIssue=!1,this._activePanel=-1,this._vishva=e,this._vishvaGUI=i;var s=$("#grndAcc");s.accordion({animate:100,heightStyle:"content",collapsible:!0,activate:function(){n._activePanel=s.accordion("option","active")},beforeActivate:function(t,e){n.refreshPanel(n.getPanelIndex(e.newHeader))}}),this._grndDiag=$("#grndDiag");var a={autoOpen:!1,resizable:!1,position:t.DialogMgr.leftCenter,minWidth:420,width:420,height:650,closeOnEscape:!1,open:function(t,e){n._fixingDragIssue?n._fixingDragIssue=!1:(n._activePanel=s.accordion("option","active"),n.refreshPanel(n._activePanel))},closeText:"",close:function(){n._vishvaGUI.resizing||n._fixingDragIssue||null!=n._materialUI&&null!=n._materialUI._textureUI&&n._materialUI._textureUI.isOpen()&&n._materialUI._textureUI.close()},dragStop:function(t,e){n._fixingDragIssue=!0,n._grndDiag.dialog("close"),n._grndDiag.dialog("open")}};this._grndDiag.dialog(a),this._grndDiag.jpo=t.DialogMgr.leftCenter,this._vishvaGUI.dialogs.push(this._grndDiag)}return e.prototype.open=function(){this._grndDiag.dialog("open")},e.prototype.isOpen=function(){return this._grndDiag.dialog("isOpen")},e.prototype.close=function(){this._grndDiag.dialog("close")},e.prototype.toggle=function(){console.log("toggling"),this.isOpen()?this.close():this.open()},e.prototype.getPanelIndex=function(t){return"General"==t.text()?0:"Material"==t.text()?1:"SPS"==t.text()?2:void 0},e.prototype.refreshPanel=function(e){0===e?(null==this._generalUI&&(this._generalUI=new t.GeneralUI(this._vishva,this._vishvaGUI)),this._generalUI.update()):2===e?(null==this._SPSUI&&(this._SPSUI=new t.LightUI(this._vishva)),this._SPSUI.update()):1===e&&(null==this._materialUI&&(this._materialUI=new t.MaterialUI(this._vishva)),this._materialUI.update()),null!=this._generalUI._snaUI&&this._generalUI._snaUI.isOpen()&&(this._generalUI._snaUI.close(),this._generalUI._snaUI.show_sNaDiag())},e}();t.GroundUI2=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){}return t.PopulateSelect=function(t,e){for(var i=t.children,n=0|i.length,s=n-1;s>=0;s--)i[s].remove();for(var a,o=0,r=e;o<r.length;o++){var l=r[o];a=document.createElement("option"),a.value=l,a.innerText=l,t.appendChild(a)}},t}();t.GuiUtils=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=function(){function i(e){this._assetDiagMap={},this._vishva=e,this._vishvaFiles=t.Vishva.vishvaFiles}return i.prototype.toggleAssetDiag=function(t){var e=this._assetDiagMap[t];null==e&&(e=this._createAssetDiag(t),this._assetDiagMap[t]=e),e.isOpen()?e.close():e.open()},i.prototype._createAssetDiag=function(t){var i=document.createElement("div");i.id=t+"Div",i.setAttribute("title",t);var n=document.createElement("table");n.id=t+"Tbl";var s=this._getFiles(["internal","assets",t],this._vishvaFiles);return this._updateAssetTable(n,t,s),i.appendChild(n),document.body.appendChild(i),new e.VDialog(i.id,t,e.DialogMgr.centerBottom,"95%","auto")},i.prototype._getFiles=function(t,e){for(var i=0,n=e;i<n.length;i++){var s=n[i];if(s instanceof Object&&s.d==t[0])return t.length>1?(t.splice(0,1),this._getFiles(t,s.f)):s.f}return e},i.prototype._updateAssetTable=function(t,i,n){var s=this;if(!(t.rows.length>0)){for(var a=function(t){return s._onAssetImgClick(t)},o=t.insertRow(),r=0,l=n;r<l.length;r++){var h=l[r],u=document.createElement("img");u.id=h.d;var c=h.d;u.src="vishva/internal/assets/"+i+"/"+c+"/"+c+".jpg",u.setAttribute("style",e.VishvaGUI.SMALL_ICON_SIZE+"cursor:pointer;"),u.className=i,u.onclick=a;o.insertCell().appendChild(u)}for(var p=t.insertRow(),d=0,g=n;d<g.length;d++){var h=g[d];p.insertCell().innerText=h.d}}},i.prototype._onAssetImgClick=function(t){var e=t.target;return"skyboxes"===e.className?this._vishva.setSky(e.id):"primitives"===e.className?this._vishva.addPrim(e.id):"particles"===e.className?(this._vishva.createParticles(e.id),console.log("particles clicked "+e.id)):this._vishva.loadAsset(e.className,e.id),!0},i}();e.InternalAssetsUI=i}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e){var i=this;this._vishva=e,this._updateTreeData(),this._itemsDiag=new t.VTreeDialog(this._vishva,"Items in Scene",t.DialogMgr.leftCenter,this.treeData),this._itemsDiag.addTreeListener(function(t,e,n){var s=t.indexOf(",");t=t.substring(0,s),i._vishva.selectMesh(t)}),this._itemsDiag.addRefreshHandler(function(){return i._itemsDiag.close(),i._updateTreeData(),i._itemsDiag.refresh(i.treeData),i._itemsDiag.open(),!1})}return e.prototype.toggle=function(){this._itemsDiag.isOpen()?this._itemsDiag.close():this._itemsDiag.open()},e.prototype._updateTreeData=function(){this.treeData=new Array;var t=this._vishva.getMeshList();this._updateMeshChildMap(t);for(var e,i=0,n=t;i<n.length;i++){var s=n[i];if(null==s.parent)if(null!=(e=this.meshChildMap[s.uniqueId])){var a={};a.d=Number(s.uniqueId).toString()+", "+s.name,a.f=new Array,this.treeData.push(a),this._addChildren(e,a.f)}else this.treeData.push(Number(s.uniqueId).toString()+", "+s.name)}},e.prototype._addChildren=function(t,e){for(var i=0,n=t;i<n.length;i++){var s=n[i],a=this.meshChildMap[s.uniqueId];if(null!=a){var o={};o.d=Number(s.parent.uniqueId).toString()+", "+s.parent.name,o.f=new Array,e.push(o),this._addChildren(a,o.f)}else e.push(Number(s.uniqueId).toString()+", "+s.name)}},e.prototype._updateMeshChildMap=function(t){this.meshChildMap={};for(var e=0,i=t;e<i.length;e++){var n=i[e];if(null!=n.parent){var s=this.meshChildMap[n.parent.uniqueId];null==s&&(s=new Array,this.meshChildMap[n.parent.uniqueId]=s),s.push(n)}}},e}();t.ItemListUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i){var n=this;this._propsVDiag=null,this._propsAcc=null,this._fixingDragIssue=!1,this._activePanel=-1,this.refreshingPropsDiag=!1,this._vishva=e,this._vishvaGUI=i,this._propsAcc=document.getElementById("propsAcc")
;var s=$(this._propsAcc);s.accordion({animate:100,heightStyle:"content",collapsible:!0,activate:function(){n._activePanel=s.accordion("option","active")},beforeActivate:function(t,e){n.refreshPanel(n.getPanelIndex(e.newHeader))}}),this._propsVDiag=new t.VDialog("propsDiag","mesh properties",t.DialogMgr.leftCenter,0,"auto",420),this._propsVDiag.onOpen(function(){n._activePanel=s.accordion("option","active"),n.refreshPanel(n._activePanel),n.refreshingPropsDiag=!1}),this._propsVDiag.onClose(function(){n._vishvaGUI.resizing||n.refreshingPropsDiag||(null!=n._generalUI._snaUI&&n._generalUI._snaUI.isOpen()&&n._generalUI._snaUI.close(),null!=n._materialUI&&null!=n._materialUI._textureUI&&n._materialUI._textureUI.isOpen()&&n._materialUI._textureUI.close(),n._vishva.isGroundPicked()&&n._vishva.unSelectGrnd())})}return e.prototype.open=function(){var t;if(this._vishva.isGroundPicked()){t=this._propsAcc.getElementsByClassName("mesh");for(var e=0;e<t.length;e++)t.item(e).style.display="none";t=this._propsAcc.getElementsByTagName("h3"),console.log("in grnd - h3 found "+t.length);for(var e=0;e<t.length;e++)t.item(e).className.indexOf("grnd")>=0&&(t.item(e).style.display="block",this._activePanel==e&&(t.item(e).nextElementSibling.style.display="block"))}else{t=this._propsAcc.getElementsByClassName("grnd");for(var e=0;e<t.length;e++)t.item(e).style.display="none";t=this._propsAcc.getElementsByTagName("h3");for(var e=0;e<t.length;e++)t.item(e).className.indexOf("mesh")>=0&&(t.item(e).style.display="block",this._activePanel==e&&(t.item(e).nextElementSibling.style.display="block"))}this._propsVDiag.open()},e.prototype.isOpen=function(){return this._propsVDiag.isOpen()},e.prototype.close=function(){this._propsVDiag.close()},e.prototype.refreshPropsDiag=function(){void 0!==this._propsVDiag&&null!==this._propsVDiag&&this._propsVDiag.isOpen()&&(this.refreshingPropsDiag=!0,this.close(),this.open())},e.prototype.refreshGeneralPanel=function(){0===this._activePanel&&this.refreshPropsDiag()},e.prototype.getPanelIndex=function(t){return"General"==t.text()?0:"Ground Dimensions"==t.text()?1:"Physics"==t.text()?2:"Material"==t.text()?3:"Lights"==t.text()?4:"Animations"==t.text()?5:"Ground SPS"==t.text()?6:void 0},e.prototype.refreshPanel=function(e){0===e?(null==this._generalUI&&(this._generalUI=new t.GeneralUI(this._vishva,this._vishvaGUI)),this._generalUI.update()):4===e?(null==this._lightUI&&(this._lightUI=new t.LightUI(this._vishva)),this._lightUI.update()):5===e?(null==this._animationUI&&(this._animationUI=new t.AnimationUI(this._vishva)),this._animationUI.update()):2===e?(null==this._physicsUI&&(this._physicsUI=new t.PhysicsUI(this._vishva)),this._physicsUI.update()):3===e?(null==this._materialUI&&(this._materialUI=new t.MaterialUI(this._vishva)),this._materialUI.update()):6===e?null==this._grndSPSUI&&(this._grndSPSUI=new t.GrndSPSUI(this._vishva)):1===e&&(null==this._grndDimUI&&(this._grndDimUI=new t.GrndDimUI(this._vishva)),this._grndDimUI.update()),null!=this._generalUI._snaUI&&this._generalUI._snaUI.isOpen()&&(this._generalUI._snaUI.close(),this._generalUI._snaUI.show_sNaDiag())},e}();t.ItemPropsUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=function(){function i(t){var i=this;this._vishva=t,this._lightAtt=document.getElementById("lightAtt"),this._lightType=document.getElementById("lightType"),this._lightDiff=new e.ColorPickerDiag("diffuse light","lightDiff","#ffffff",e.DialogMgr.centerBottom,function(t,e,n){i._applyLight()}),this._lightSpec=new e.ColorPickerDiag("specular light","lightSpec","#ffffff",e.DialogMgr.centerBottom,function(t,e,n){i._applyLight()}),this._lightInten=document.getElementById("lightInten"),this._lightRange=document.getElementById("lightRange"),this._lightRadius=document.getElementById("lightAtt"),this._lightAngle=document.getElementById("lightAngle"),this._lightExp=document.getElementById("lightExp"),this._lightGndClr=document.getElementById("lightGndClr"),this._lightDirX=document.getElementById("lightDirX"),this._lightDirY=document.getElementById("lightDirY"),this._lightDirZ=document.getElementById("lightDirZ"),this._lightAtt.onchange=function(){i._lightAtt.checked?i._applyLight():i._vishva.detachLight()},this._lightType.onchange=function(){return i._applyLight()},this._lightInten.onchange=function(){return i._applyLight()},this._lightRange.onchange=function(){return i._applyLight()},this._lightAngle.onchange=function(){return i._applyLight()},this._lightExp.onchange=function(){return i._applyLight()},this._lightDirX.onchange=function(){return i._applyLight()},this._lightDirY.onchange=function(){return i._applyLight()},this._lightDirZ.onchange=function(){return i._applyLight()}}return i.prototype.update=function(){var e=this._vishva.getAttachedLight();null===e?(this._lightAtt.checked=!1,e=new t.LightParm):this._lightAtt.checked=!0,this._lightType.value=e.type,this._lightDiff.setColor(e.diffuse.toHexString()),this._lightSpec.setColor(e.specular.toHexString()),this._lightInten.value=Number(e.intensity).toString(),this._lightRange.value=Number(e.range).toString(),this._lightRadius.value=Number(e.radius).toString(),this._lightAngle.value=Number(e.angle).toString(),this._lightExp.value=Number(e.exponent).toString(),this._lightGndClr.value=e.gndClr.toHexString(),this._lightDirX.value=Number(e.direction.x).toString(),this._lightDirY.value=Number(e.direction.y).toString(),this._lightDirZ.value=Number(e.direction.z).toString()},i.prototype._applyLight=function(){if(this._lightAtt.checked){var e=new t.LightParm;e.type=this._lightType.value,e.diffuse=BABYLON.Color3.FromHexString(this._lightDiff.getColor()),e.specular=BABYLON.Color3.FromHexString(this._lightSpec.getColor()),e.intensity=parseFloat(this._lightInten.value),e.range=parseFloat(this._lightRange.value),e.radius=parseFloat(this._lightRadius.value),e.angle=parseFloat(this._lightAngle.value),e.direction.x=parseFloat(this._lightDirX.value),e.direction.y=parseFloat(this._lightDirY.value),e.direction.z=parseFloat(this._lightDirZ.value),e.exponent=parseFloat(this._lightExp.value),e.gndClr=BABYLON.Color3.FromHexString(this._lightGndClr.value),this._vishva.attachAlight(e)}},i}();e.LightUI=i}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=(BABYLON.Material,function(){function e(e,i){var n=this;this._scene=e,this._updateTreeData(),this._materialsDiag=new t.VTreeDialog(null,"Materials in Scene",t.DialogMgr.center,this.treeData),this._materialsDiag.addTreeListener(function(t,e,s){if(s){var a=t.indexOf(",");t=t.substring(0,a);var o;o=0==e.indexOf("MultiMaterial")?n._getMutliMaterialById(t):n._scene.getMaterialByID(t),i(o)}}),this._materialsDiag.addRefreshHandler(function(){return n._materialsDiag.close(),n._updateTreeData(),n._materialsDiag.refresh(n.treeData),n._materialsDiag.open(),!1})}return e.prototype._getMutliMaterialById=function(t){for(var e=this._scene.multiMaterials,i=null,n=0,s=e;n<s.length;n++){var a=s[n];if(a.id==t){i=a;break}}return i},e.prototype.toggle=function(){this._materialsDiag.isOpen()?this._materialsDiag.close():this._materialsDiag.open()},e.prototype._updateTreeData=function(){this.treeData=new Array;for(var t=this._scene.materials,e=0,i=t;e<i.length;e++){var n=i[e];this.treeData.push(n.id+", "+n.name)}var s=this._scene.multiMaterials,a={};a.d="MultiMaterial";for(var o=new Array,r=0,l=s;r<l.length;r++){var h=l[r];o.push(h.id+","+h.name)}a.f=o,this.treeData.push(a)},e.prototype._addChildren=function(t,e){for(var i=0,n=t;i<n.length;i++){var s=n[i];if(s instanceof BABYLON.MultiMaterial){var a=s.subMaterials,o={};o.d=s.id+", "+s.name,o.f=new Array,e.push(o),this._addChildren(a,o.f)}else e.push(s.id+", "+s.name)}},e}());t.MaterialListUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var Material=BABYLON.Material,org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e){var i=this;this._vishva=e,this._matVis=document.getElementById("matVis"),this._matVisVal=document.getElementById("matVisVal"),this._matVisVal.value="1.00",this._matVis.oninput=function(){i._matVisVal.value=Number(i._matVis.value).toFixed(2),i._vishva.setMeshVisibility(parseFloat(i._matVis.value))},this._matCount=document.getElementById("matCount"),this._matIDs=document.getElementById("matIDs"),this._matIDs.onchange=function(){i._updateMatDetails()},this._matID=document.getElementById("matID"),this._matName=document.getElementById("matName"),this._matType=document.getElementById("matType"),this._matBF=document.getElementById("matBF"),this._matBF.onchange=function(){i._vishva.setMaterialBFC(i._matIDs.value,i._matBF.checked)},this._matClone=document.getElementById("matClone"),this._matClone.onclick=function(){i._vishva.cloneMaterial(i._matID.innerText),i.update()},this._matReplace=document.getElementById("matReplace"),this._matReplace.onclick=function(){return null==i._materialListUI&&(i._materialListUI=new t.MaterialListUI(i._vishva.scene,function(t){i._vishva.getMeshPicked().material=t,i.update()})),i._materialListUI.toggle(),i.update(),!1},this._matColType=document.getElementById("matColType"),this._matColType.onchange=function(){var t=i._vishva.getMeshColor(i._matID.innerText,i._matColType.value);i._matColDiag.setColor(t)},this._matColDiag=new t.ColorPickerDiag("mesh color","matCol",this._vishva.getMeshColor(this._matID.innerText,this._matColType.value),t.DialogMgr.centerBottom,function(e,n,s){var a=i._vishva.setMeshColor(i._matID.innerText,i._matColType.value,e);null!==a&&t.DialogMgr.showAlertDiag(a)}),this._matTextType=document.getElementById("matTextType"),this._matTextType.onchange=function(){var t=i._vishva.getMatTexture(i._matID.innerText,i._matTextType.value);i._textID=t[0],i._textName=t[1],i._matTextImg.src=i._textName,i._textName.indexOf(".tga")>=0?i._matTextImg.src=i._vishva.TGA_IMAGE:i._matTextImg.src=i._textName,null==i._textID?(i._matCreateText.setAttribute("style","display:block"),i._matRemText.setAttribute("style","display:none")):(i._matCreateText.setAttribute("style","display:none"),i._matRemText.setAttribute("style","display:block"))},this._matTextImg=document.getElementById("matTextImg"),this._matTextImg.onclick=function(){null!=i._textID&&(null==i._textureUI&&(i._textureUI=new t.TextureUI(i._vishva)),i._textureUI.setParms(i._textID,i._textName,i._matTextType.value,i._matID.innerText,i._matTextImg),i._textureUI.open())},this._matCreateText=document.getElementById("matCreateText"),this._matCreateText.onclick=function(){i._matCreateText.setAttribute("style","display:none"),i._matRemText.setAttribute("style","display:block"),i._textID=i._vishva.createText(),i._textName="",i._vishva.setMatTexture(i._matID.innerText,i._matTextType.value,i._textID),null==i._textureUI&&(i._textureUI=new t.TextureUI(i._vishva)),i._textureUI.setParms(i._textID,i._textName,i._matTextType.value,i._matID.innerText,i._matTextImg),i._textureUI.open()},this._matRemText=document.getElementById("matRemText"),this._matRemText.onclick=function(){i._matCreateText.setAttribute("style","display:block"),i._matRemText.setAttribute("style","display:none"),i._vishva.removeMatTexture(i._matID.innerText,i._matTextType.value),i._textID=null,i._textName=i._vishva.NO_TEXTURE,i._matTextImg.src=i._textName},this.update()}return e.prototype.update=function(){this._matVis.value=Number(this._vishva.getMeshVisibility()).toString(),this._matVisVal.value=Number(this._matVis.value).toFixed(2);var e=this._vishva.getMatNames();null!=e&&(this._matCount.innerText=Number(e.length).toString(),t.GuiUtils.PopulateSelect(this._matIDs,e),this._updateMatDetails())},e.prototype._updateMatDetails=function(){this._matID.innerText=this._matIDs.value,this._matName.innerText=this._vishva.getMaterialName(this._matIDs.value),this._matType.innerText=this._vishva.getMaterialType(this._matIDs.value);var e=this._vishva.getMaterialBFC(this._matIDs.value);"string"==typeof e?t.DialogMgr.showAlertDiag(e):this._matBF.checked=e,this._matColDiag.setColor(this._vishva.getMeshColor(this._matIDs.value,this._matColType.value));var i=this._vishva.getMatTexture(this._matID.innerText,this._matTextType.value);this._textID=i[0],this._textName=i[1],this._matTextImg.src=this._textName,this._textName.indexOf(".tga")>=0?this._matTextImg.src=this._vishva.TGA_IMAGE:this._matTextImg.src=this._textName,null==this._textID?(this._matCreateText.setAttribute("style","display:block"),this._matRemText.setAttribute("style","display:none")):(this._matCreateText.setAttribute("style","display:none"),this._matRemText.setAttribute("style","display:block")),null!=this._textureUI&&this._textureUI.isOpen()&&(this._textureUI.setParms(this._textID,this._textName,this._matTextType.value,this._matID.innerText,this._matTextImg),this._textureUI.close(),this._textureUI.open())},e}();t.MaterialUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=function(){function i(t){var i=this;this._vishva=t,this._phyEna=document.getElementById("phyEna"),this._phyType=document.getElementById("phyType"),this._phyMass=document.getElementById("phyMass"),this._phyRes=document.getElementById("phyRes"),this._phyResVal=document.getElementById("phyResVal"),this._phyResVal.value="0.0",this._phyRes.oninput=function(){i._phyResVal.value=i._formatValue(i._phyRes.value)},this._phyFric=document.getElementById("phyFric"),this._phyFricVal=document.getElementById("phyFricVal");this._phyFricVal.value="0.0",this._phyFric.oninput=function(){i._phyFricVal.value=i._formatValue(i._phyFric.value)};var n=document.getElementById("phyApply"),s=document.getElementById("phyTest"),a=document.getElementById("phyReset");n.onclick=function(t){return i._applyPhysics(),e.DialogMgr.showAlertDiag("physics applied"),!1},s.onclick=function(t){return i._testPhysics(),!1},a.onclick=function(t){return i._resetPhysics(),!1}}return i.prototype._formatValue=function(t){return"1"===t?"1.0":"0"===t?"0.0":t},i.prototype.update=function(){var t=this._vishva.getMeshPickedPhyParms();null!==t?(this._phyEna.setAttribute("checked","true"),this._phyType.value=Number(t.type).toString(),this._phyMass.value=Number(t.mass).toString(),this._phyRes.value=Number(t.restitution).toString(),this._phyResVal.value=this._formatValue(this._phyRes.value),this._phyFric.value=Number(t.friction).toString(),this._phyFricVal.value=this._formatValue(this._phyFric.value)):(this._phyEna.checked=!1,this._phyType.value="2",this._phyMass.value="1",this._phyRes.value="0",this._phyResVal.value="0.0",this._phyFric.value="0",this._phyFricVal.value="0.0")},i.prototype._applyPhysics=function(){var e;this._phyEna.checked?(e=new t.PhysicsParm,e.type=parseInt(this._phyType.value),e.mass=parseFloat(this._phyMass.value),e.restitution=parseFloat(this._phyRes.value),e.friction=parseFloat(this._phyFric.value)):e=null,this._vishva.setMeshPickedPhyParms(e)},i.prototype._testPhysics=function(){var e;e=new t.PhysicsParm,e.type=parseInt(this._phyType.value),e.mass=parseFloat(this._phyMass.value),e.restitution=parseFloat(this._phyRes.value),e.friction=parseFloat(this._phyFric.value),this._vishva.testPhysics(e)},i.prototype._resetPhysics=function(){this._vishva.resetPhysics()},i}();e.PhysicsUI=i}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i){var n=this;this.enableToolTips=!0,this._vishva=e,this._vishvaGUI=i,this._settingDiag=new t.VDialog("settingDiag","Settings",t.DialogMgr.rightCenter,"","",350),this._camCol=$("#camCol"),this._autoEditMenu=$("#autoEditMenu"),this._showToolTips=$("#showToolTips"),this._showInvis=$("#showInvis"),this._showDisa=$("#showDisa"),this._snapper=$("#snapper");var s={};s.text="save",s.click=function(e){n._vishva.enableCameraCollision(n._camCol.prop("checked")),n._vishva.enableAutoEditMenu(n._autoEditMenu.prop("checked")),n.enableToolTips=n._showToolTips.prop("checked"),n._showInvis.prop("checked")?n._vishva.showAllInvisibles():n._vishva.hideAllInvisibles(),n._showDisa.prop("checked")?n._vishva.showAllDisabled():n._vishva.hideAllDisabled();var i=n._vishva.snapper(n._snapper.prop("checked"));return null!=i?(t.DialogMgr.showAlertDiag(i),!1):(n._settingDiag.close(),n._vishvaGUI.refreshPropsDiag(),!0)};var a={};a.text="Cancel",a.click=function(t){return n._settingDiag.close(),!0};var o=[s,a];this._settingDiag.setButtons(o)}return e.prototype._updateSettings=function(){this._camCol.prop("checked",this._vishva.isCameraCollisionOn()),this._autoEditMenu.prop("checked",this._vishva.isAutoEditMenuOn()),this._showToolTips.prop("checked",this.enableToolTips)},e.prototype.toggle=function(){this._settingDiag.isOpen()?this._settingDiag.close():(this._updateSettings(),this._settingDiag.open())},e}();t.SettingsUI=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=BABYLON.Vector3,n=function(){function n(t,e){this.STATE_IND="state",this._vishva=t,this._vishvaGUI=e}return n.prototype.isOpen=function(){return this.sNaDialog.dialog("isOpen")},n.prototype.close=function(){this.sNaDialog.dialog("close")},n.prototype.create_sNaDiag=function(){var t=this;$("#sNaDetails").tabs(),this.sNaDialog=$("#sNaDiag");var i={};i.autoOpen=!1,i.modal=!1,i.resizable=!1,i.width="auto",i.height="auto",i.title="Sensors and Actuators",i.closeOnEscape=!1,i.closeText="",i.dragStop=function(e,i){t.sNaDialog.dialog("close"),t.sNaDialog.dialog("open")},this.sNaDialog.dialog(i),this.sNaDialog.jpo=e.DialogMgr.center,this._vishvaGUI.dialogs.push(this.sNaDialog),this.sensSel=document.getElementById("sensSel"),this.actSel=document.getElementById("actSel");for(var n=this._vishva.getSensorList(),s=this._vishva.getActuatorList(),a=0,o=n;a<o.length;a++){var r=o[a],l=document.createElement("option");l.value=r,l.innerHTML=r,this.sensSel.add(l)}for(var h=0,u=s;h<u.length;h++){var c=u[h],l=document.createElement("option");l.value=c,l.innerHTML=c,this.actSel.add(l)}this.sensTbl=document.getElementById("sensTbl"),this.actTbl=document.getElementById("actTbl")},n.prototype.show_sNaDiag=function(){var t=this,i=this._vishva.getSensors();if(null==i)return void e.DialogMgr.showAlertDiag("no mesh selected");var n=this._vishva.getActuators();if(null==n)return void e.DialogMgr.showAlertDiag("no mesh selected");null==this.sNaDialog&&this.create_sNaDiag(),this.updateSensActTbl(i,this.sensTbl),this.updateSensActTbl(n,this.actTbl),document.getElementById("addSens").onclick=function(e){var i=t.sensSel.item(t.sensSel.selectedIndex),n=i.value;return t._vishva.addSensorbyName(n),t.updateSensActTbl(t._vishva.getSensors(),t.sensTbl),t.sNaDialog.dialog("close"),t.sNaDialog.dialog("open"),!0},document.getElementById("addAct").onclick=function(e){var i=t.actSel.item(t.actSel.selectedIndex),n=i.value;return t._vishva.addActuaorByName(n),t.updateSensActTbl(t._vishva.getActuators(),t.actTbl),t.sNaDialog.dialog("close"),t.sNaDialog.dialog("open"),!0},this.sNaDialog.dialog("open")},n.prototype.updateSensActTbl=function(t,e){for(var i=this,n=e.rows.length,s=n-1;s>0;s--)e.deleteRow(s);n=t.length;for(var s=0;s<n;s++){var a=e.insertRow(),o=a.insertCell();o.innerHTML=t[s].getName(),o=a.insertCell(),o.innerHTML=t[s].getProperties().signalId,o=a.insertCell();var r=document.createElement("BUTTON");r.innerHTML="edit";$(r).button();var l=s;r.id=l.toString(),r.sa=t[s],o.appendChild(r),r.onclick=function(t){var e=t.currentTarget,n=e.sa;return"SENSOR"===n.getType()?i.showEditSensDiag(n):i.showEditActDiag(n),!0},o=a.insertCell();var h=document.createElement("BUTTON");h.innerHTML="del";$(h).button(),h.id=l.toString(),h.row=a,h.sa=t[s],o.appendChild(h),h.onclick=function(t){var n=t.currentTarget,s=n.row;return e.deleteRow(s.rowIndex),i._vishva.removeSensorActuator(n.sa),!0}}},n.prototype.createEditSensDiag=function(){var t=this;this.editSensDiag=$("#editSensDiag");var e={};e.autoOpen=!1,e.modal=!0,e.resizable=!1,e.width="auto",e.title="Edit Sensor",e.closeText="",e.closeOnEscape=!1,e.open=function(){t._vishva.disableKeys()},e.close=function(){t._vishva.enableKeys()},this.editSensDiag.dialog(e)},n.prototype.showEditSensDiag=function(t){var e=this;document.getElementById("editSensDiag.sensName").innerHTML=t.getName(),null==this.editSensDiag&&this.createEditSensDiag(),this.editSensDiag.dialog("open");var i=document.getElementById("editSensDiag.parms"),n=i.firstChild;null!=n&&i.removeChild(n);var s=this.formCreate(t.getProperties());i.appendChild(s);var a={};a.text="save",a.click=function(i){return e.formRead(t.getProperties()),t.handlePropertiesChange(),e.updateSensActTbl(e._vishva.getSensors(),e.sensTbl),e.editSensDiag.dialog("close"),!0};var o=[a];this.editSensDiag.dialog("option","buttons",o)},n.prototype.createEditActDiag=function(){var t=this;this.editActDiag=$("#editActDiag");var e={};e.autoOpen=!1,e.modal=!0,e.resizable=!1,e.width="auto",e.title="Edit Actuator",e.closeText="",e.closeOnEscape=!1,e.open=function(e,i){t._vishva.disableKeys()},e.close=function(e,i){t._vishva.enableKeys()},this.editActDiag.dialog(e)},n.prototype.showEditActDiag=function(t){var e=this;document.getElementById("editActDiag.actName").innerHTML=t.getName(),null==this.editActDiag&&this.createEditActDiag(),this.editActDiag.dialog("open");var i=document.getElementById("editActDiag.parms"),n=i.firstChild;null!=n&&i.removeChild(n);var s=this.formCreate(t.getProperties());i.appendChild(s);var a={};a.text="save",a.click=function(i){return e.formRead(t.getProperties()),t.handlePropertiesChange(),e.updateSensActTbl(e._vishva.getActuators(),e.actTbl),e.editActDiag.dialog("close"),!0};var o=[a];this.editActDiag.dialog("option","buttons",o)},n.prototype.formCreate=function(t){this.mapKey2Ele={};for(var n=document.createElement("table"),s=Object.keys(t),a=0,o=s;a<o.length;a++){var r=o[a];if(r.split("_")[0]!==this.STATE_IND){var l=n.insertRow(),h=l.insertCell();h.innerHTML=r,h=l.insertCell();var u=typeof t[r];if("object"===u){if(t[r]instanceof e.SelectType){var c=t[r],p=c.values,d=document.createElement("select");this.mapKey2Ele[r]=d;for(var g=0,m=p;g<m.length;g++){var v=m[g],f=document.createElement("option");v===c.value&&(f.selected=!0),f.innerText=v,d.add(f)}h.appendChild(d)}else if(t[r]instanceof i){var y=new e.VInputVector3(h,t[r]);this.mapKey2Ele[r]=y}else if(t[r]instanceof e.FileInputType){var _=this._createFileInput(t[r]);this.mapKey2Ele[r]=_,h.appendChild(_)}else if(t[r]instanceof e.Range){var b=document.createElement("input");this.mapKey2Ele[r]=b,b.className="ui-widget-content ui-corner-all",b.value=t[r];var S=t[r];b.type="range",b.max=new Number(S.max).toString(),b.min=new Number(S.min).toString(),b.step=new Number(S.step).toString(),b.value=new Number(S.value).toString(),h.appendChild(b)}}else{var b=document.createElement("input");if(this.mapKey2Ele[r]=b,b.className="ui-widget-content ui-corner-all",b.value=t[r],"string"===u||"number"===u)b.type="text",b.value=t[r];else if("boolean"===u){var A=t[r];b.type="checkbox",A&&b.setAttribute("checked","true")}h.appendChild(b)}}}return n},n.prototype.formRead=function(t){for(var n=Object.keys(t),s=0,a=n;s<a.length;s++){var o=a[s];if(o.split("_")[0]!==this.STATE_IND){var r=typeof t[o];if("object"===r){if(t[o]instanceof e.SelectType){var l=t[o],h=this.mapKey2Ele[o];l.value=h.value}else if(t[o]instanceof i){var u=this.mapKey2Ele[o];t[o]=u.getValue()}else if(t[o]instanceof e.Range){var c=this.mapKey2Ele[o],p=t[o];p.value=parseFloat(c.value)}}else{var c=this.mapKey2Ele[o];if("string"===r||"number"===r)if("number"===r){var d=parseFloat(c.value);isNaN(d)?t[o]=0:t[o]=d}else t[o]=c.value;else"boolean"===r&&(t[o]=c.checked)}}}},n.prototype._createFileInput=function(i){var n=this,s=document.createElement("button"),a=document.createElement("label");null==i.value?a.textContent="No file chosen":a.textContent=i.value,s.innerText="Choose File",s.onclick=function(s){null==n._sndAssetTDiag&&(n._sndAssetTDiag=new e.VTreeDialog(n._vishva,i.title,e.DialogMgr.centerBottom,t.Vishva.vishvaFiles,i.filter,i.openAll)),n._sndAssetTDiag.addTreeListener(function(t,e,n){n&&i.filter.indexOf(t.substring(t.length-4))>=0&&(a.textContent=e+t,i.value="vishva/"+a.textContent)}),n._sndAssetTDiag.toggle()};var o=document.createElement("div");return o.appendChild(a),o.appendChild(document.createElement("br")),o.appendChild(s),o},n}();e.SnaUI=n}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=function(){function i(i){var n=this;this._vishva=i,this._textureDiag=new e.VDialog("textureDiag","Texture",e.DialogMgr.centerBottom,"auto","auto",0,!1),this._textureImg=document.getElementById("textImg"),this._textIDEle=document.getElementById("textID"),this._textType=document.getElementById("textType"),this._textImgSrc=document.getElementById("textImgSrc"),this._matHScale=document.getElementById("matHScale"),this._matHScale.onchange=function(){n._vishva.setTextHScale(n._textID,Number(n._matHScale.value))},this._matVScale=document.getElementById("matVScale"),this._matVScale.onchange=function(){n._vishva.setTextVScale(n._textID,Number(n._matVScale.value))},this._matRot=document.getElementById("matRot"),this._matRot.oninput=function(){n._vishva.setTextRot(n._textID,Number(n._matRot.value))},this._matHO=document.getElementById("matHO"),this._matHO.oninput=function(){n._vishva.setTextHO(n._textID,Number(n._matHO.value))},this._matVO=document.getElementById("matVO"),this._matVO.oninput=function(){n._vishva.setTextVO(n._textID,Number(n._matVO.value))},document.getElementById("changeTexture").onclick=function(){null==n._textListDiag&&(n._textListDiag=new e.VTreeDialog(n._vishva,"select texture",e.DialogMgr.center,t.Vishva.vishvaFiles,".jpg$|.png$|.tga$|.bmp$",!0),n._textListDiag.addTreeListener(function(t,e,i){if(i){var s="vishva/"+e+t;n._vishva.setTextURL(n._textID,s),n._textName=s,n._textImgSrc.innerText=s,s.indexOf(".tga")>=0&&(s=n._vishva.TGA_IMAGE),n._textureImg.src=s,n._matTextImg.src=s}}),n._textListDiag.setModal(!0)),n._textListDiag.open()}}return i.prototype.update=function(){this._matHScale.value=this._vishva.getTextHScale(this._textID),this._matVScale.value=this._vishva.getTextVScale(this._textID),this._matRot.value=this._vishva.getTextRot(this._textID),this._matHO.value=this._vishva.getTextHO(this._textID),this._matVO.value=this._vishva.getTextVO(this._textID)},i.prototype.open=function(){this._textureDiag.open()},i.prototype.isOpen=function(){return this._textureDiag.isOpen()},i.prototype.close=function(){this._textureDiag.close()},i.prototype.setParms=function(t,e,i,n,s){this._textID=t,this._textIDEle.innerText=t,this._textName=e,this._textImgSrc.innerText=e,this._textType.innerText=i,this._matID=n,this._matTextImg=s,this._textureImg.src=this._matTextImg.src,this.update()},i}();e.TextureUI=i}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i,n,s,a,o,r){void 0===i&&(i=""),void 0===n&&(n=""),void 0===s&&(s=t.DialogMgr.centerBottom),void 0===o&&(o=""),void 0===r&&(r=!0);var l=this;this.value=i;var h;h=e instanceof HTMLElement?e:document.getElementById(e);var u=document.createElement("button"),c=document.createElement("label");c.textContent=null==i?"No file chosen":i,u.innerText="Choose File";var p;u.onclick=function(e){p=new t.VTreeDialog(null,n,s,a,o,r),p.addTreeListener(function(t,e,i){i&&o.indexOf(t.substring(t.length-4))>=0&&(c.textContent=e+t,l.value="vishva/"+c.textContent)}),p.toggle()},h.appendChild(c),h.appendChild(document.createElement("br")),h.appendChild(u)}return e.prototype.getValue=function(){return this.value},e.prototype.setValue=function(t){this.value=t},e}();t.VFileInput=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t,e){void 0===e&&(e=0);var i,n=this;i=t instanceof HTMLElement?t:document.getElementById(t),this._inE=document.createElement("input"),this._inE.type="text",this._inE.value=Number(e).toString(),this._inE.size=2,this._inE.style.display="inline-block",this._inE.onkeypress=function(t){t.stopPropagation()},this._inE.onkeydown=function(t){t.stopPropagation()},this._inE.onkeyup=function(t){t.stopPropagation()},this._inE.onchange=function(t){var e=Number(n._inE.value);isNaN(e)&&(n._inE.value="0"),t.preventDefault(),null!=n.onChange&&n.onChange(Number(n._inE.value))},i.appendChild(this._inE)}return t.prototype.getValue=function(){var t=Number(this._inE.value);return isNaN(t)?0:t},t.prototype.setValue=function(t){this._inE.value=Number(t).toString()},t}();t.VInputNumber=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t,e){var i=this;this.onSelect=null;var n=document.getElementById(t);this._s=document.createElement("select"),this._s.onchange=function(){null!=i.onSelect&&i.onSelect(i._s.value)},n.appendChild(this._s),this.populateSelect(e)}return t.prototype.populateSelect=function(t){for(var e=this._s.children,i=0|e.length,n=i-1;n>=0;n--)e[n].remove();for(var s,a=0,o=t;a<o.length;a++){var r=o[a];s=document.createElement("option"),s.value=r.id,s.innerText=r.desc,this._s.appendChild(s)}},t.prototype.getValue=function(){return this._s.value},t}();t.VInputSelect=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t,e){void 0===e&&(e="");var i,n=this;i=t instanceof HTMLElement?t:document.getElementById(t),this._inE=document.createElement("input"),this._inE.type="text",this._inE.style.display="inline-block",this._inE.onkeypress=function(t){t.stopPropagation()},this._inE.onkeydown=function(t){t.stopPropagation()},this._inE.onkeyup=function(t){t.stopPropagation()},this._inE.onchange=function(t){t.preventDefault(),null!=n.onChange&&n.onChange(n._inE.value)},i.appendChild(this._inE)}return t.prototype.getValue=function(){return this._inE.value},t.prototype.setValue=function(t){this._inE.value=t},t}();t.VInputText=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Vector2,i=function(){function i(i,n){var s=this;this._v=n?n.clone():new e(0,0),this._x=new t.VInputNumber(i,this._v.x),this._x.onChange=function(t){s._v.x=t},this._y=new t.VInputNumber(i,this._v.y),this._y.onChange=function(t){s._v.y=t}}return i.prototype.getValue=function(){return this._v},i.prototype.setValue=function(t){this._v.x=t.x,this._v.y=t.y,this._x.setValue(t.x),this._y.setValue(t.y)},i}();t.VInputVector2=i}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Vector3,i=function(){function i(i,n){var s=this;this._v=n?n.clone():new e(0,0,0),this._x=new t.VInputNumber(i,this._v.x),this._x.onChange=function(t){s._v.x=t},
this._y=new t.VInputNumber(i,this._v.y),this._y.onChange=function(t){s._v.y=t},this._z=new t.VInputNumber(i,this._v.z),this._z.onChange=function(t){s._v.z=t}}return i.prototype.getValue=function(){return this._v},i.prototype.setValue=function(t){this._v.x=t.x,this._v.y=t.y,this._v.z=t.z,this._x.setValue(t.x),this._y.setValue(t.y),this._z.setValue(t.z)},i}();t.VInputVector3=i}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(e){var i=function(){function i(t){var i=this;this.local=!0,this.menuBarOn=!0,this.dialogs=new Array,this.resizing=!1,this._vishva=t,this._setSettings(),$(document).tooltip({open:function(t,e){i._settingDiag.enableToolTips||e.tooltip.stop().remove()}}),$("input").on("focus",function(){i._vishva.disableKeys()}),$("input").on("blur",function(){i._vishva.enableKeys()}),this.createNavMenu(),e.DialogMgr.createAlertDiag(),window.addEventListener("resize",function(t){return i.onWindowResize(t)})}return i.prototype.onWindowResize=function(t){for(var i=0,n=this.dialogs;i<n.length;i++){var s=n[i],a=s.jpo;if(null!=a){s.dialog("option","position",a);s.dialog("isOpen")&&(this.resizing=!0,s.dialog("close"),s.dialog("open"),this.resizing=!1)}}for(var o=0,r=e.DialogMgr.dialogs;o<r.length;o++){var l=r[o];l.position(),l.isOpen()}},i.prototype.createNavMenu=function(){var i=this,n=document.getElementById("showNavMenu");n.style.visibility="visible",document.getElementById("navMenubar").style.visibility="visible";var s=$("#navMenubar"),a={my:"left center",at:"right center",of:n};s.position(a),s.show(null),n.onclick=function(t){return i.menuBarOn?s.hide("slide",100):s.show("slide",100),i.menuBarOn=!i.menuBarOn,!0},document.getElementById("navAdd").onclick=function(n){null==i._addAssetTDiag&&(i._addAssetTDiag=new e.VTreeDialog(i._vishva,"Assets",e.DialogMgr.leftCenter,t.Vishva.vishvaFiles,".obj$|.babylon$|.glb$|.gltf$",!1),i._addAssetTDiag.addTreeListener(function(t,e,n){n&&(t.indexOf(".obj")>0||t.indexOf(".babylon")>0||t.indexOf(".glb")>0||t.indexOf(".gltf")>0)&&i._vishva.loadAsset2(e,t)}),i._addAssetTDiag.addRefreshHandler(function(){$.getScript("vishva/vishvaFiles.js",function(){i._addAssetTDiag.refresh(t.Vishva.vishvaFiles)})})),i._addAssetTDiag.toggle()},document.getElementById("navPrim").onclick=function(){null==i._addInternalAssetUI&&(i._addInternalAssetUI=new e.InternalAssetsUI(i._vishva)),i._addInternalAssetUI.toggleAssetDiag("primitives")},document.getElementById("downWorld").onclick=function(t){var e=i._vishva.saveWorld();return null==e||(null==i._downloadDialog&&i._createDownloadDiag(),i._downloadLink.href=e,i._downloadDialog.dialog("open"),!1)},document.getElementById("navItems").onclick=function(t){return null==i._items&&(i._items=new e.ItemListUI(i._vishva)),i._items.toggle(),!1},document.getElementById("navEnv").onclick=function(t){return null==i._environment&&(null==i._addInternalAssetUI&&(i._addInternalAssetUI=new e.InternalAssetsUI(i._vishva)),i._environment=new e.EnvironmentUI(i._vishva,i._addInternalAssetUI,i)),i._environment.toggle(),!1},document.getElementById("navEdit").onclick=function(t){return null!=i._itemProps&&i._itemProps.isOpen()?i._itemProps.close():i.showPropDiag(),!1},document.getElementById("navSettings").onclick=function(t){return i._settingDiag.toggle(),!1};var o=document.getElementById("helpLink"),r=null;o.onclick=function(t){return null==r&&(r=new e.VDialog("helpDiv","Help",e.DialogMgr.center,"","",500)),r.toggle(),!0},document.getElementById("debugLink").onclick=function(t){return i._vishva.toggleDebug(),!0}},i.prototype.showPropDiag=function(){return this._vishva.anyMeshSelected()?(null==this._itemProps&&(this._itemProps=new e.ItemPropsUI(this._vishva,this)),this._itemProps.open(),!0):void e.DialogMgr.showAlertDiag("no mesh selected")},i.prototype.handeEditControlClose=function(){null!=this._itemProps&&this._itemProps.close()},i.prototype.refreshPropsDiag=function(){null!=this._itemProps&&this._itemProps.refreshPropsDiag()},i.prototype.handleTransChange=function(){null!=this._itemProps&&this._itemProps.refreshGeneralPanel()},i.prototype.getSettings=function(){var t=new n;return t.enableToolTips=this._settingDiag.enableToolTips,t},i.prototype._setSettings=function(){null==this._settingDiag&&(this._settingDiag=new e.SettingsUI(this._vishva,this));var t=this._vishva.getGuiSettings();null!==t&&(this._settingDiag.enableToolTips=t.enableToolTips)},i.prototype._createDownloadDiag=function(){this._downloadLink=document.getElementById("downloadLink"),this._downloadDialog=$("#saveDiv"),this._downloadDialog.dialog(),this._downloadDialog.dialog("close")},i.prototype._createUploadDiag=function(){var t=this,e=document.getElementById("loadFileInput");document.getElementById("loadFileOk").onclick=function(e){return function(i){var n=e.files;if(0===n.length)return alert("no file slected"),null;for(var s=null,a=0;a<n.length;a++)s=n[a];return t._vishva.loadAssetFile(s),t._loadDialog.dialog("close"),!0}}(e),this._loadDialog=$("#loadDiv"),this._loadDialog.dialog(),this._loadDialog.dialog("close")},i.LARGE_ICON_SIZE="width:128px;height:128px;",i.SMALL_ICON_SIZE="width:64px;height:64px;",i}();e.VishvaGUI=i;var n=function(){function t(){}return t}();e.GuiSettings=n;var s=function(){function t(){this.r=0,this.g=0,this.b=0}return t}();e.RGB=s;var a=function(){function t(t,e,i,n){this.type="Range",this.min=0,this.max=0,this.value=0,this.step=0,this.min=t,this.max=e,this.value=i,this.step=n}return t}();e.Range=a;var o=function(){function t(){this.type="SelectType"}return t}();e.SelectType=o;var r=function(){function t(t,e,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=!0),this.title=t,this.filter=e,this.openAll=i,this.type="FileInputType"}return t}();e.FileInputType=r}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t,e,i,n,s){void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=.01),void 0===s&&(s=0);var a=document.getElementById(t),o=document.createElement("div"),r=document.createElement("div");r.setAttribute("class","ui-slider-handle"),o.appendChild(r);var l=$(r);a.appendChild(o),this._r=$(o),this._r.slider({min:e,max:i,step:n,value:s,create:function(){l.text(s)},slide:function(t,e){l.text(e.value)}})}return t.prototype.getValue=function(){return this._r.slider("option","value")},t.prototype.setValue=function(t){return this._r.slider("option","value",t)},t}();t.VRange=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t,e,i,n){if(void 0===n&&(n=!1),this._closeIcon="vt-icon ui-icon ui-icon-plus",this._openIcon="vt-icon ui-icon ui-icon-minus",this._leafIcon="vt-icon ui-icon ui-icon-blank",this._clickListener=null,this.prevEle=null,t instanceof HTMLDivElement?this._treeEle=t:this._treeEle=document.getElementById(t),null==this._treeEle)return void console.error("Unable to locate element "+t);this._treeData=e,this._filter=i,this._open=n;for(var s=this._treeEle.getElementsByTagName("ul"),a=0;a<s.length;a++)"vtree"==s.item(a).id&&this._treeEle.removeChild(s.item(a));this._create()}return t.prototype.addClickListener=function(t){void 0===t&&(t=null),this._clickListener=t},t.prototype.refresh=function(t,e){this._treeEle.removeChild(this._vtree),this._treeData=t,null!=e&&(this._filter=e),this._create()},t.prototype.filter=function(t){if(0==t.length)return void this._showAll();this._hideAll();for(var e=this._vtree.getElementsByClassName("treeFile"),i=0;i<e.length;i++){e.item(i).childNodes[1].textContent.indexOf(t)>=0&&(e.item(i).style.display="block",this._openParent(e.item(i)))}},t.prototype._hideAll=function(){for(var t=this._vtree.getElementsByTagName("li"),e=0;e<t.length;e++)t.item(e).style.display="none"},t.prototype._showAll=function(){var t;t=this._vtree.getElementsByTagName("li");for(var e=0;e<t.length;e++)t.item(e).style.display="block";t=this._vtree.getElementsByTagName("ul");for(var e=0;e<t.length;e++)t.item(e).setAttribute("class","show");t=this._vtree.getElementsByClassName("treeFolderClose");for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class","treeFolderOpen");t=this._vtree.getElementsByClassName(this._closeIcon);for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class",this._openIcon)},t.prototype._openParent=function(t){for(;t.parentElement!=this._vtree;)t.parentElement instanceof HTMLUListElement&&(t.parentElement.setAttribute("class","show"),t.parentElement.parentElement.setAttribute("class","treeFolderOpen"),t.parentElement.parentElement.style.display="block",t.parentElement.parentElement.firstElementChild.setAttribute("class",this._openIcon)),t=t.parentElement},t.prototype.expandAll=function(){var t;t=this._vtree.getElementsByClassName("treeFolderClose");for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class","treeFolderOpen");t=this._vtree.getElementsByClassName("hide");for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class","show");t=this._vtree.getElementsByClassName(this._closeIcon);for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class",this._openIcon)},t.prototype.collapseAll=function(){var t;t=this._vtree.getElementsByClassName("treeFolderOpen");for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class","treeFolderClose");t=this._vtree.getElementsByClassName("show");for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class","hide");t=this._vtree.getElementsByClassName(this._openIcon);for(var e=t.length-1;e>=0;e--)t.item(e).setAttribute("class",this._closeIcon)},t.prototype._create=function(){var t=this;if(null!=this._filter)try{this._re=new RegExp(this._filter)}catch(t){console.error("invalid reqular expression "+this._filter+". Will ignore"),this._re=null}else this._re=null;this._vtree=document.createElement("ul"),this._buildUL(this._vtree,this._treeData),this._vtree.onclick=function(e){return t._treeClick(e)},this._treeEle.appendChild(this._vtree)},t.prototype._buildUL=function(t,e){var i,n,s,a,o,r,l;this._open?(o=this._openIcon,r="treeFolderOpen",l="show"):(o=this._closeIcon,r="treeFolderClose",l="hide");for(var h=0,u=e;h<u.length;h++){var c=u[h];i=document.createElement("li"),n=document.createElement("span"),"object"==typeof c?(i.setAttribute("class",r),n.setAttribute("class",o),n.style.display="inline-block",i.appendChild(n),s=document.createElement("span"),s.className="txt",s.innerText=c.d,i.appendChild(s),a=document.createElement("ul"),a.setAttribute("class",l),i.appendChild(a),t.appendChild(i),this._buildUL(a,c.f)):(i.setAttribute("class","treeFile"),null==this._re||this._re.test(c)||(i.style.display="none"),n.setAttribute("class",this._leafIcon),n.style.display="inline-block",i.appendChild(n),s=document.createElement("span"),s.className="txt",s.innerText=c,i.appendChild(s),t.appendChild(i))}},t.prototype.onClose=function(t,e){null!=this.prevEle&&(this.prevEle.style.backgroundColor="transparent",this.prevEle.style.color="white")},t.prototype._treeClick=function(t){var e=!1,i=t.target,n=i.parentElement;if(i instanceof HTMLSpanElement){"txt"!=i.className&&(e=!0);var s=n.getAttribute("class");if(e)"treeFolderOpen"==s?(n.setAttribute("class","treeFolderClose"),n.firstElementChild.setAttribute("class",this._closeIcon),n.lastElementChild.setAttribute("class","hide")):"treeFolderClose"==s&&(n.setAttribute("class","treeFolderOpen"),n.firstElementChild.setAttribute("class",this._openIcon),n.lastElementChild.setAttribute("class","show"));else{i.style.backgroundColor="white",i.style.color="black",null!=this.prevEle&&(this.prevEle.style.backgroundColor="transparent",this.prevEle.style.color="white"),this.prevEle=i;var a=null,o="",r=!1;for("treeFile"==s&&(r=!0),a=i.innerText;null!=n;)n.parentElement instanceof HTMLLIElement&&(o=n.parentElement.childNodes[1].textContent+"/"+o),n=n instanceof HTMLDivElement?null:n.parentElement;null!=this._clickListener&&this._clickListener(a,o,r)}}},t}();t.VTree=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){!function(t){var e=function(){function e(e,i,n,s,a,o){var r=this;this._diagHtml='<div style="vertical-align:middle">search <span style="padding-right: 1ch;"></span><button ><span class="ui-icon ui-icon-search" title="filter"></span></button></div><hr><div style="height:400px;width:100%;overflow-y:auto;border-style:solid;border-color:white;display:block"></div><hr><button><span class="ui-icon ui-icon-plus" title="expand all"></span></button><button><span class="ui-icon ui-icon-minus" title="collapse all"></span></button><button><span class="ui-icon ui-icon-refresh" title="refresh"></span></button>',this._vishva=e;var l=document.createElement("div");l.innerHTML=this._diagHtml,document.body.appendChild(l);var h=l.getElementsByTagName("div")[1];this._treeDiag=new t.VDialog(l,i,n,300),this._treeDiag.setResizable(!0),this._tree=new t.VTree(h,s,a,o);var u=new t.VInputText(l.getElementsByTagName("span")[0]),c=l.getElementsByTagName("button"),p=c.item(0),d=c.item(1),g=c.item(2),m=c.item(3);u.onChange=function(){r._tree.filter(u.getValue().trim())},p.onclick=function(){r._tree.filter(u.getValue().trim())},d.onclick=function(){r._tree.expandAll()},g.onclick=function(){r._tree.collapseAll()},m.onclick=function(){r._refreshHandler()},$(p).button(),$(d).button(),$(g).button(),$(m).button()}return e.prototype.addTreeListener=function(t){void 0===t&&(t=null),this._tree.addClickListener(t)},e.prototype.addRefreshHandler=function(t){this._refreshHandler=t},e.prototype.toggle=function(){this._treeDiag.isOpen()?this._treeDiag.close():this._treeDiag.open()},e.prototype.setModal=function(t){this._treeDiag.setModal(t)},e.prototype.open=function(){this._treeDiag.open()},e.prototype.isOpen=function(){return this._treeDiag.isOpen()},e.prototype.close=function(){this._treeDiag.close()},e.prototype.refresh=function(t){this._tree.refresh(t)},e}();t.VTreeDialog=e}(t.gui||(t.gui={}))}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(){this.names=new Array,this.values=new Array;var t=window.location.search;t=t.substring(1);for(var e=t.split("&"),i=0;i<e.length;i++){var n=e[i],s=n.split("=");if(2===s.length){var a=s[0],o=s[1];this.names.push(a),this.values.push(o)}}}return t.prototype.getParm=function(t){var e=this.names.indexOf(t);return-1!==e?this.values[e]:null},t}();t.HREFsearch=e}(t.util||(t.util={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){var e=function(){function t(t){this._seed=t}return t.prototype.generate=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this._seed=(9301*this._seed+49297)%233280,t+this._seed/233280*(e-t)},t}();t.Random=e}(t.util||(t.util={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.Vector2,n=BABYLON.Vector3,s=t.ssatguru.babylonjs.util.Random,a=BABYLON.SolidParticleSystem,o=function(){function t(t,e,n,s,o){this.sx=0,this.sz=0,this.sCount=0,this._sprdTLC=new i(0,0),this._sprdBRC=new i(0,0),this.name=t,this._vishva=e,this.mesh=n,this._groundMesh=s,this._spreadDtls=o,this.sps=new a(t,this._vishva.scene,{updatable:!1,isPickable:!1}),this._updateSpreadParms(this.mesh,this._groundMesh,this._spreadDtls)}return t.prototype.generate=function(){var t=this;this._updateSpreadParms(this.mesh,this._groundMesh,this._spreadDtls),this.sps.addShape(this.mesh,this.sCount,{positionFunction:function(e,i,n){t._spread(e)}}),this.spsMesh=this.sps.buildMesh(),this.spsMesh.material=this.mesh.material,this.spsMesh.doNotSerialize=!0,this.id=this.spsMesh.id},t.prototype.serialize=function(){return{id:this.id,name:this.name,meshID:this.mesh.id,groundMeshID:this._groundMesh.id,spreadDtls:this._spreadDtls}},t.prototype.setSpreadDtls=function(t){this._spreadDtls=t},t.prototype.getSpreadDtls=function(){return this._spreadDtls},t.prototype._updateSpreadParms=function(t,e,a){a.seed||(this._spreadDtls.seed=100*Math.random()),this._rand=new s(this._spreadDtls.seed),a.step||(a.step=t.getBoundingInfo().boundingSphere.radius),a.sprdCon1||(a.sprdCon1=new i(e._minX+a.step,e._minZ+a.step)),a.sprdCon2||(a.sprdCon2=new i(e._maxX-a.step,e._maxZ-a.step)),this._sprdTLC.x=Math.min(a.sprdCon1.x,a.sprdCon2.x),this._sprdTLC.y=Math.max(a.sprdCon1.y,a.sprdCon2.y),this._sprdBRC.x=Math.max(a.sprdCon1.x,a.sprdCon2.x),this._sprdBRC.y=Math.min(a.sprdCon1.y,a.sprdCon2.y),this.sCount=((this._sprdBRC.x-this._sprdTLC.x)/a.step+1)*((this._sprdTLC.y-this._sprdBRC.y)/a.step+1),this.sx=this._sprdTLC.x,this.sz=this._sprdTLC.y,a.posRange||(a.posRange=.5),a.sclRange||(a.sclRange=.5),a.rotRange||(a.rotRange=Math.PI/20);var o;a.posMax||(o=a.step*a.posRange,a.posMax=new n(o,0,o)),a.posMin||(o=-a.step*a.posRange,a.posMin=new n(o,o,o)),a.sclMax||(o=1+a.sclRange,a.sclMax=new n(o,o,o)),a.sclMin||(o=1-a.sclRange,a.sclMin=new n(o,o,o)),a.rotMax||(o=a.rotRange,a.rotMax=new n(o,o,o)),a.rotMin||(o=-a.rotRange,a.rotMin=new n(o,o,o))},t.prototype._spread=function(t){t.position.x=this.sx+this._rand.generate(this._spreadDtls.posMin.x,this._spreadDtls.posMax.x),t.position.z=this.sz+this._rand.generate(this._spreadDtls.posMin.z,this._spreadDtls.posMax.z),t.position.y=this._groundMesh.getHeightAtCoordinates(t.position.x,t.position.z),t.position.y=t.position.y+this._rand.generate(this._spreadDtls.posMin.y,this._spreadDtls.posMax.y),t.scaling.x=this._rand.generate(this._spreadDtls.sclMin.x,this._spreadDtls.sclMax.x),t.scaling.y=this._rand.generate(this._spreadDtls.sclMin.y,this._spreadDtls.sclMax.y),t.scaling.z=this._rand.generate(this._spreadDtls.sclMin.z,this._spreadDtls.sclMax.z),t.rotation.x=this._rand.generate(this._spreadDtls.rotMin.x,this._spreadDtls.rotMax.x),t.rotation.y=this._rand.generate(this._spreadDtls.rotMin.y,this._spreadDtls.rotMax.y),t.rotation.z=this._rand.generate(this._spreadDtls.rotMin.z,this._spreadDtls.rotMax.z),this.sx=this.sx+this._spreadDtls.step,this.sx>this._sprdBRC.x&&(this.sx=this._sprdTLC.x,this.sz=this.sz-this._spreadDtls.step)},t}();e.GroundSPS=o}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){var i=t.ssatguru.babylonjs.component.EditControl,n=t.ssatguru.babylonjs.component.CharacterController,s=BABYLON.Animation,a=BABYLON.ArcRotateCamera,o=BABYLON.AssetsManager,r=BABYLON.Color3,l=BABYLON.Color4,h=BABYLON.CubeTexture,u=BABYLON.CSG,c=BABYLON.DirectionalLight,p=BABYLON.DynamicTerrain,d=BABYLON.Engine,g=t.ssatguru.babylonjs.vishva.GroundSPS,m=BABYLON.HemisphericLight,v=BABYLON.Light,f=BABYLON.Matrix,y=BABYLON.Mesh,_=BABYLON.MeshBuilder,b=BABYLON.ParticleSystem,S=BABYLON.PhysicsImpostor,A=BABYLON.Quaternion,x=BABYLON.Scene,I=BABYLON.SceneLoader,k=BABYLON.SceneSerializer,P=BABYLON.ShadowGenerator,M=BABYLON.Debug.SkeletonViewer,w=BABYLON.StandardMaterial,T=BABYLON.Tags,C=BABYLON.Texture,D=BABYLON.Vector3,B=t.ssatguru.babylonjs.vishva.gui.VishvaGUI,E=BABYLON.WaterMaterial,N=function(){function t(e,i,n,s){var a=this;if(this.actuator="none",this.snapTransOn=!1,this.snapRotOn=!1,this.snapScaleOn=!1,this.snapperOn=!1,this.snapTransValue=.5,this.snapRotValue=Math.PI/4,this.snapScaleValue=.5,this.ow=.01,this.spaceWorld=!1,this.skyboxTextures="vishva/internal/textures/skybox-default/default",this.avatarFolder="vishva/internal/avatar/",this.avatarFile="starterAvatars.babylon",this.spawnPosition=new D(0,.2,0),this._avDisabled=!1,this._animBlend=.1,this._avEllipsoid=new BABYLON.Vector3(.5,1,.5),this._avEllipsoidOffset=new D(0,1,0),this.NO_TEXTURE="vishva/internal/textures/no-texture.jpg",this.TGA_IMAGE="vishva/internal/textures/tga-image.jpg",this.groundTexture="vishva/internal/textures/ground.jpg",this.groundBumpTexture="vishva/internal/textures/ground-normal.jpg",this.groundHeightMap="vishva/internal/textures/ground_heightMap.png",this.terrainTexture="vishva/internal/textures/earth.jpg",this.terrainHeightMap="vishva/internal/textures/worldHeightMap.jpg",this.primTexture="vishva/internal/textures/Birch.jpg",this.waterTexture="vishva/internal/textures/waterbump.png",this.snowTexture="vishva/internal/textures/flare.png",this.rainTexture="vishva/internal/textures/raindrop-1.png",this.snowPart=null,this.snowing=!1,this.rainPart=null,this.raining=!1,this.SOUND_ASSET_LOCATION="vishva/assets/sounds/",this.RELATIVE_ASSET_LOCATION="",this._cameraCollision=!0,this._cameraEllipsoid=new D(1,1,1),this.switchDisabled=!1,this.keysDisabled=!1,this.showBoundingBox=!1,this.autoEditMenu=!0,this.enablePhysics=!0,this.vishvaSerialized=null,this.isFocusOnAv=!0,this.cameraAnimating=!1,this.moveLimitStart=114,this.moveLimitEnd=124,this.oldAvPos=new D(0,0,0),this.fogDensity=0,this.meshesPicked=null,this.isMeshSelected=!1,this.cameraTargetPos=new D(0,0,0),this.saveAVcameraPos=new D(0,0,0),this.animFunc=function(){return a.animateCamera()},this.animFunc2=function(){return a.justReFocus()},this.showingAllInvisibles=!1,this.meshPickedPhyParms=null,this.didPhysTest=!1,this.skelViewerArr=[],this.debugVisible=!1,this.prevUid=0,this.uidPlus=0,t.vishva=this,this.editEnabled=!1,this.frames=0,this.f=0,!d.isSupported())return void alert("not supported");this.loadingMsg=document.getElementById("loadingMsg"),this.loadingMsg.style.visibility="visible",this.loadingStatus=document.getElementById("loadingStatus"),this.editEnabled=n,this.key=new L,this.canvas=document.getElementById(s),this.engine=new d(this.canvas,!0),this.scene=new x(this.engine),this.scene.enablePhysics(),this.scene.clearColor=new l(0,0,0,1),this.scene.ambientColor=new r(0,0,0),this.scene.fogColor=new BABYLON.Color3(.9,.9,.85),window.addEventListener("resize",function(t){return a.onWindowResize(t)}),window.addEventListener("keydown",function(t){return a.onKeyDown(t)},!1),window.addEventListener("keyup",function(t){return a.onKeyUp(t)},!1),I.CleanBoneMatrixWeights=!0,this.scenePath=i,"empty"==e?this.onSceneLoaded(this.scene):(this.loadingStatus.innerHTML="downloading world",this.loadSceneFile(i,e+".js",this.scene))}return t.prototype.loadSceneFile=function(t,e,i){var n=this,s=new o(i),a=s.addTextFileTask("sceneLoader",t+e);a.onSuccess=function(t){return n.onTaskSuccess(t)},a.onError=function(t){return n.onTaskFailure(t)},s.load()},t.prototype.getGuiSettings=function(){return null!==this.vishvaSerialized?this.vishvaSerialized.guiSettings:null},t.prototype.onTaskSuccess=function(t){var e=this,i=t,n=JSON.parse(i.text);this.vishvaSerialized=n.VishvaSerialized,this.snas=this.vishvaSerialized.snas,this._cameraCollision=this.vishvaSerialized.settings.cameraCollision,this.autoEditMenu=this.vishvaSerialized.settings.autoEditMenu;var s="data:"+i.text;I.ShowLoadingScreen=!1,this.loadingStatus.innerHTML="loading scene",I.Append("",s,this.scene,function(t){return e.onSceneLoaded(t)})},t.prototype.onTaskFailure=function(t){alert("scene load failed")},t.prototype.setShadowProperty=function(t,e){e.useBlurExponentialShadowMap=!0,e.bias=-.3},t.prototype.onSceneLoaded=function(t){var i=this;this.loadingStatus.innerHTML="checking assets";for(var s=!1,a=!1,o=!1,l=!1,h=!1,u=!1,p=0,d=t.meshes;p<d.length;p++){var v=d[p];v.receiveShadows=!1,T.HasTags(v)&&(T.MatchesQuery(v,"Vishva.avatar")?(s=!0,this.avatar=v,this.avatar.ellipsoidOffset=this._avEllipsoidOffset,this.avatar.ellipsoid=this._avEllipsoid):T.MatchesQuery(v,"Vishva.sky")?(h=!0,this.skybox=v,this.skybox.isPickable=!1):T.MatchesQuery(v,"Vishva.ground")&&(l=!0,this.ground=v))}for(var f=0,y=t.skeletons;f<y.length;f++){var _=y[f];(T.MatchesQuery(_,"Vishva.skeleton")||"Vishva.skeleton"===_.name)&&(a=!0,this.avatarSkeleton=_)}a||console.error("ALARM: No Skeleton found");for(var b=0,S=t.lights;b<S.length;b++){var A=S[b];T.MatchesQuery(A,"Vishva.sun")&&(o=!0,this.sun=A)}if(o)for(var I=0,k=t.lights;I<k.length;I++){var A=k[I];if("Vishva.dl01"===A.id){this.sunDR=A,this.shadowGenerator=A.getShadowGenerator();var M=this.sunDR;this.setShadowProperty(M,this.shadowGenerator)}}else{console.log("no vishva sun found. creating sun"),this.sun=new m("Vishva.hl01",new D(1,1,0),this.scene),this.sun.groundColor=new r(.5,.5,.5),T.AddTagsTo(this.sun,"Vishva.sun"),this.sunDR=new c("Vishva.dl01",new D(-1,-1,0),this.scene),this.sunDR.position=new D(0,1048,0);var M=this.sunDR;this.shadowGenerator=new P(1024,M),this.setShadowProperty(M,this.shadowGenerator)}for(var w=0,C=t.meshes;w<C.length;w++){var v=C[w];null!=v&&v instanceof BABYLON.InstancedMesh&&this.shadowGenerator.getShadowMap().renderList.push(v)}for(var B=0,E=t.cameras;B<E.length;B++){var N=E[B];T.MatchesQuery(N,"Vishva.camera")&&(u=!0,this.mainCamera=N,this.setCameraSettings(this.mainCamera),this.mainCamera.attachControl(this.canvas,!0))}if(u||(console.log("no vishva camera found. creating camera"),this.mainCamera=this.createCamera(this.scene,this.canvas),this.scene.activeCamera=this.mainCamera),this.mainCamera.checkCollisions=this._cameraCollision,this.mainCamera.collisionRadius=this._cameraEllipsoid,l){if(this.ground.receiveShadows=!0,null!=this.vishvaSerialized.groundSPSserializeds){this.GroundSPSs=new Array;for(var L=0,O=this.vishvaSerialized.groundSPSserializeds;L<O.length;L++){var V=O[L],v=this.scene.getMeshByID(V.meshID);if(null!=v){var R=this.scene.getMeshByID(V.groundMeshID),U=new g(V.name,this,v,R,V.spreadDtls);try{U.generate()}catch(t){console.log("error during gSPS.generate()"),console.log(t)}this.GroundSPSs.push(U)}else console.log("could not find sps mesh for id = "+V.meshID)}}}else console.log("no vishva ground found. creating ground"),this.createGround_htmap(this.scene);h||(console.log("no vishva sky found. creating sky"),this.skybox=this.createSkyBox(this.scene),this.setLight(.5)),this.scene.fogMode!==x.FOGMODE_EXP&&(this.scene.fogMode=x.FOGMODE_EXP,this.scene.fogDensity=0),this.editEnabled&&(this.scene.onPointerDown=function(t,e){return i.pickObject(t,e)}),s?(this.avatarSkeleton.enableBlending(this._animBlend),this.cc=new n(this.avatar,this.mainCamera,this.scene),this.setCharacterController(this.cc),this.cc.start()):(console.log("no vishva av found. creating av"),this.createAvatar()),e.SNAManager.getSNAManager().unMarshal(this.snas,this.scene),this.snas=null,this.render()},t.prototype.render=function(){var t=this;this.scene.registerBeforeRender(function(){return t.process()}),this.scene.executeWhenReady(function(){return t.startRenderLoop()})},t.prototype.startRenderLoop=function(){var t=this;this.editEnabled?this.vishvaGUI=new B(this):this.vishvaGUI=null,this.engine.hideLoadingUI(),this.loadingMsg.style.visibility="hidden",this.engine.runRenderLoop(function(){return t.scene.render()})},t.prototype.process=function(){if(this.sunDR.position.x=this.avatar.position.x+100,this.sunDR.position.y=this.avatar.position.y+100,this.sunDR.position.z=this.avatar.position.z+0,!this.cameraAnimating){if(this.keysDisabled&&!this.key.esc)return void this.resetKeys();this.isMeshSelected&&(this.key.focus&&this.setFocusOnMesh(),this.key.esc&&(this.key.esc=!1,this.removeEditControl()),this.key.trans&&this.setTransOn(),this.key.rot&&this.setRotOn(),this.key.scale&&this.setScaleOn()),this._avDisabled||(this.isFocusOnAv?this.key.esc&&this.setFocusOnNothing():(this.key.up||this.key.down||this.key.esc)&&(null==this.editControl?this.switchFocusToAV():this.editControl.isEditing()||this.switchFocusToAV())),this.key.esc&&this.multiUnSelectAll(),this.resetKeys()}},t.prototype.resetKeys=function(){this.key.focus=!1,this.key.esc=!1,this.key.trans=!1,this.key.rot=!1,this.key.scale=!1},t.prototype.getMeshPicked=function(){return this.meshPicked},t.prototype.pickObject=function(t,e){if(t.preventDefault(),2==t.button&&(this.key.alt||this.key.ctl)&&e.hit){if(this.key.ctl&&(!this.isMeshSelected||e.pickedMesh!==this.meshPicked))return void this.multiSelect(e.pickedMesh);if(this.isMeshSelected)if(e.pickedMesh===this.meshPicked){if(this.key.ctl)return;this.setFocusOnMesh()}else this.multiUnSelect(e.pickedMesh),this.switchEditControl(e.pickedMesh),this.snapperOn&&this.snapToGlobal();else this.selectForEdit(e.pickedMesh)}},t.prototype.selectForEdit=function(t){var n=this;this.multiUnSelect(t),this.isMeshSelected=!0,this.meshPicked=t,e.SNAManager.getSNAManager().disableSnAs(this.meshPicked),this.savePhyParms(),this.switchToQuats(this.meshPicked),this.editControl=new i(this.meshPicked,this.mainCamera,this.canvas,.75),this.editControl.addActionEndListener(function(t){n.vishvaGUI.handleTransChange()}),this.editControl.enableTranslation(),this.spaceWorld&&this.editControl.setLocal(!1),this.autoEditMenu&&this.vishvaGUI.showPropDiag(),this.snapperOn?this.setSnapperOn():(this.snapTransOn&&(this.editControl.setTransSnap(!0),this.editControl.setTransSnapValue(this.snapTransValue)),this.snapRotOn&&(this.editControl.setRotSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue)),this.snapScaleOn&&(this.editControl.setScaleSnap(!0),this.editControl.setScaleSnapValue(this.snapScaleValue)))},t.prototype.switchEditControl=function(t){if(!this.switchDisabled){e.SNAManager.getSNAManager().enableSnAs(this.meshPicked),this.restorePhyParms();this.meshPicked;this.meshPicked=t,this.savePhyParms(),this.switchToQuats(this.meshPicked),this.editControl.switchTo(this.meshPicked),e.SNAManager.getSNAManager().disableSnAs(this.meshPicked),this.vishvaGUI.refreshPropsDiag()}},t.prototype.switchToQuats=function(t){if(void 0===t.rotationQuaternion||null===t.rotationQuaternion){var e=t.rotation;t.rotationQuaternion=A.RotationYawPitchRoll(e.y,e.x,e.z)}},t.prototype.highLight=function(t){t.enableEdgesRendering(),t.edgesWidth=4},t.prototype.unHighLight=function(t){t.disableEdgesRendering()},t.prototype.multiSelect=function(t){null==this.meshesPicked&&(this.meshesPicked=new Array),this.multiUnSelect(t)||(this.meshesPicked.push(t),this.highLight(t))},t.prototype.multiUnSelect=function(t){if(null==this.meshesPicked)return!1;var e=this.meshesPicked.indexOf(t);return e>=0&&(this.meshesPicked.splice(e,1),this.unHighLight(t),!0)},t.prototype.multiUnSelectAll=function(){if(null!==this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){var i=e[t];this.unHighLight(i)}this.meshesPicked=null}},t.prototype.removeEditControl=function(){this.multiUnSelectAll(),this.isMeshSelected=!1,this.editControl.detach(),this.editControl=null,this.vishvaGUI.handeEditControlClose(),null!=this.meshPicked&&(e.SNAManager.getSNAManager().enableSnAs(this.meshPicked),this.restorePhyParms())},t.prototype.switchFocusToAV=function(){this.mainCamera.detachControl(this.canvas),this.frames=25,this.f=this.frames,this.delta=this.saveAVcameraPos.subtract(this.mainCamera.position).scale(1/this.frames);var t=new D(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z);this.delta2=t.subtract(this.mainCamera.target).scale(1/this.frames),this.cameraAnimating=!0,this.scene.registerBeforeRender(this.animFunc)},t.prototype.focusOnMesh=function(t,e){this.mainCamera.detachControl(this.canvas),this.frames=e,this.f=e,this.delta2=t.getAbsolutePivotPoint().subtract(this.mainCamera.target).scale(1/this.frames),this.cameraAnimating=!0,this.scene.registerBeforeRender(this.animFunc2)},t.prototype.animateCamera=function(){new D(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z).subtract(this.mainCamera.target).length()>.01&&this.mainCamera.setTarget(this.mainCamera.target.add(this.delta2)),this.saveAVcameraPos.subtract(this.mainCamera.position).length()>.01&&this.mainCamera.setPosition(this.mainCamera.position.add(this.delta)),--this.f<0&&(this.isFocusOnAv=!0,this.cameraAnimating=!1,this.scene.unregisterBeforeRender(this.animFunc),
this.mainCamera.attachControl(this.canvas),this.cc.start())},t.prototype.justReFocus=function(){this.mainCamera.setTarget(this.mainCamera.target.add(this.delta2)),--this.f<0&&(this.cameraAnimating=!1,this.scene.unregisterBeforeRender(this.animFunc2),this.mainCamera.attachControl(this.canvas))},t.prototype.onWindowResize=function(t){this.engine.resize()},t.prototype.onKeyDown=function(t){var e=t;16===e.keyCode&&(this.key.shift=!0),17===e.keyCode&&(this.key.ctl=!0),18===e.keyCode&&(this.key.alt=!0),27===e.keyCode&&(this.key.esc=!1);var i=String.fromCharCode(e.keyCode);"W"!==i&&38!==e.keyCode||(this.key.up=!0),"S"!==i&&40!==e.keyCode||(this.key.down=!0),"1"===i&&(this.key.trans=!1),"2"===i&&(this.key.rot=!1),"3"===i&&(this.key.scale=!1),"F"===i&&(this.key.focus=!1)},t.prototype.onKeyUp=function(t){var e=t;16===e.keyCode&&(this.key.shift=!1),17===e.keyCode&&(this.key.ctl=!1),18===e.keyCode&&(this.key.alt=!1),27===e.keyCode&&(this.key.esc=!0);var i=String.fromCharCode(e.keyCode);"W"!==i&&38!==e.keyCode||(this.key.up=!1),"S"!==i&&40!==e.keyCode||(this.key.down=!1),"1"===i&&(this.key.trans=!0),"2"===i&&(this.key.rot=!0),"3"===i&&(this.key.scale=!0),"F"===i&&(this.key.focus=!0)},t.prototype.createPrimMaterial=function(){this.primMaterial=new w("primMat",this.scene),this.primMaterial.diffuseTexture=new C(this.primTexture,this.scene),this.primMaterial.diffuseColor=new r(1,1,1),this.primMaterial.specularColor=new r(0,0,0)},t.prototype.setPrimProperties=function(t){null==this.primMaterial&&this.createPrimMaterial();var e=t.getBoundingInfo().boundingSphere.radiusWorld,i=new D(0,e,-(e+2)),n=D.TransformCoordinates(i,this.avatar.getWorldMatrix());t.position.addInPlace(n),t.checkCollisions=!0,this.shadowGenerator.getShadowMap().renderList.push(t),T.AddTagsTo(t,"Vishva.prim Vishva.internal"),t.id=new Number(Date.now()).toString(),t.name=t.id,t.material=this.primMaterial.clone("m"+t.name)},t.prototype.addPrim=function(t){var e=null;"plane"===t?e=this.addPlane():"box"===t?e=this.addBox():"sphere"===t?e=this.addSphere():"disc"===t?e=this.addDisc():"cylinder"===t?e=this.addCylinder():"cone"===t?e=this.addCone():"torus"===t&&(e=this.addTorus()),null!==e&&(this.isMeshSelected?this.switchEditControl(e):this.selectForEdit(e),this.animateMesh(e))},t.prototype.addPlane=function(){var t=y.CreatePlane("",1,this.scene);return this.setPrimProperties(t),t.material.backFaceCulling=!1,t},t.prototype.addBox=function(){var t=y.CreateBox("",1,this.scene);return this.setPrimProperties(t),t},t.prototype.addSphere=function(){var t=y.CreateSphere("",10,1,this.scene);return this.setPrimProperties(t),t},t.prototype.addDisc=function(){var t=y.CreateDisc("",.5,20,this.scene);return this.setPrimProperties(t),t.material.backFaceCulling=!1,t},t.prototype.addCylinder=function(){var t=y.CreateCylinder("",1,1,1,20,1,this.scene);return this.setPrimProperties(t),t},t.prototype.addCone=function(){var t=y.CreateCylinder("",1,0,1,20,1,this.scene);return this.setPrimProperties(t),t},t.prototype.addTorus=function(){var t=y.CreateTorus("",1,.25,20,this.scene);return this.setPrimProperties(t),t},t.prototype.switchGround=function(){return this.isMeshSelected?(T.RemoveTagsFrom(this.ground,"Vishva.ground"),this.ground.isPickable=!0,this.ground=this.meshPicked,this.ground.isPickable=!1,T.AddTagsTo(this.ground,"Vishva.ground"),this.removeEditControl(),null):"no mesh selected"},t.prototype.instance_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";var t,e=new Number(Date.now()).toString();return null!=this.meshPicked&&this.meshPicked instanceof BABYLON.InstancedMesh?(t=this.meshPicked.clone(e,null,!0),t.scaling.copyFrom(this.meshPicked.scaling)):t=this.meshPicked.createInstance(e),console.log(this.meshPicked),console.log(t),this.animateMesh(t),this.switchEditControl(t),this.shadowGenerator.getShadowMap().renderList.push(t),null},t.prototype.toggleCollision=function(){if(!this.isMeshSelected)return"no mesh selected";this.meshPicked.checkCollisions=!this.meshPicked.checkCollisions},t.prototype.enableCollision=function(t){this.meshPicked.checkCollisions=t},t.prototype.isCollideable=function(){return this.meshPicked.checkCollisions},t.prototype.toggleEnable=function(){if(!this.isMeshSelected)return"no mesh selected";this.meshPicked.setEnabled(!this.meshPicked.isEnabled())},t.prototype.disableIt=function(t){this.meshPicked.setEnabled(!t)},t.prototype.isDisabled=function(){return!this.meshPicked.isEnabled()},t.prototype.showAllDisabled=function(){for(var t=0,e=this.scene.meshes;t<e.length;t++){var i=e[t];i.isEnabled()||(this.highLight(i),i.outlineWidth=this.ow)}},t.prototype.hideAllDisabled=function(){for(var t=0,e=this.scene.meshes;t<e.length;t++){var i=e[t];i.isEnabled()||this.unHighLight(i)}},t.prototype.makeVisibile=function(t){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked;t?T.HasTags(e)&&T.MatchesQuery(e,"invisible")&&(T.RemoveTagsFrom(this.meshPicked,"invisible"),this.meshPicked.visibility=1,this.meshPicked.isPickable=!0,this.showingAllInvisibles&&this.unHighLight(e)):(T.AddTagsTo(this.meshPicked,"invisible"),this.showingAllInvisibles?(this.meshPicked.visibility=.5,this.highLight(e),this.meshPicked.isPickable=!0):(this.meshPicked.visibility=0,this.meshPicked.isPickable=!1))},t.prototype.isVisible=function(){return!T.HasTags(this.meshPicked)||!T.MatchesQuery(this.meshPicked,"invisible")},t.prototype.showAllInvisibles=function(){this.showingAllInvisibles=!0;for(var t=0;t<this.scene.meshes.length;t++){var e=this.scene.meshes[t];T.HasTags(e)&&T.MatchesQuery(e,"invisible")&&(e.visibility=.5,this.highLight(e),e.isPickable=!0)}},t.prototype.hideAllInvisibles=function(){this.showingAllInvisibles=!1;for(var t=0;t<this.scene.meshes.length;t++)for(var t=0;t<this.scene.meshes.length;t++){var e=this.scene.meshes[t];T.HasTags(e)&&T.MatchesQuery(e,"invisible")&&(e.visibility=0,this.unHighLight(e),e.isPickable=!1)}},t.prototype.makeParent=function(){if(!this.isMeshSelected)return"no mesh selected";if(null==this.meshesPicked||0===this.meshesPicked.length)return"select atleast two mesh. use 'ctl' and mosue right click to select multiple meshes";this.meshPicked.computeWorldMatrix(!0);for(var t,e=f.Invert(this.meshPicked.getWorldMatrix()),i=0,n=this.meshesPicked;i<n.length;i++){var s=n[i];try{s.computeWorldMatrix(!0),s===this.meshPicked.parent&&(t=this.meshPicked.getWorldMatrix(),null==this.meshPicked.rotationQuaternion&&(this.meshPicked.rotationQuaternion=A.Identity()),t.decompose(this.meshPicked.scaling,this.meshPicked.rotationQuaternion,this.meshPicked.position),this.meshPicked.parent=null),s!==this.meshPicked&&(this.unHighLight(s),t=s.getWorldMatrix().multiply(e),null==s.rotationQuaternion&&(s.rotationQuaternion=A.Identity()),t.decompose(s.scaling,s.rotationQuaternion,s.position),s.parent=this.meshPicked)}catch(t){console.error("was not able to parent "+s.id+" - "+s.name),console.error(t)}}return this.unHighLight(this.meshPicked),this.meshesPicked=null,null},t.prototype.removeParent=function(){return this.isMeshSelected?null==this.meshPicked.parent?"this mesh has no parent":(this.meshPicked.getWorldMatrix().decompose(this.meshPicked.scaling,this.meshPicked.rotationQuaternion,this.meshPicked.position),this.meshPicked.parent=null,"parent removed"):"no mesh selected"},t.prototype.removeChildren=function(){if(!this.isMeshSelected)return"no mesh selected";var t=this.meshPicked,e=t.getChildren();if(0===e.length)return"this mesh has no children";for(var i,n=0,s=0,a=e;s<a.length;s++){var o=a[s];try{i=o.getWorldMatrix(),null==o.rotationQuaternion&&(o.rotationQuaternion=A.Identity()),i.decompose(o.scaling,o.rotationQuaternion,o.position),o.parent=null,n++}catch(t){console.error("was not able to remove child "+o.id+" - "+o.name),console.error(t)}}return n+" children removed"},t.prototype.clone_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";var t,e=new Array;if(null!=this.meshesPicked)for(var i=0,n=this.meshesPicked;i<n.length;i++){var s=n[i];if(s!==this.meshPicked){if(null!=s.parent&&(s.parent==this.meshPicked||this.meshesPicked.indexOf(s.parent)>=0)){this.unHighLight(s);continue}null!=s&&s instanceof BABYLON.InstancedMesh||(t=this.clonetheMesh(s),e.push(t))}}return t=this.clonetheMesh(this.meshPicked),null!=this.meshesPicked&&(e.push(t),this.meshesPicked=e),this.switchEditControl(t),null},t.prototype.clonetheMesh=function(t){var e=new Number(Date.now()).toString(),i=t.clone(e,null,!1);return i.scaling.copyFrom(t.scaling),delete i.sensors,delete i.actuators,this.animateMesh(i),this.unHighLight(t),this.shadowGenerator.getShadowMap().renderList.push(i),i},t.prototype.animateMesh=function(t){var e=t.scaling.clone().scaleInPlace(1.5),i=t.scaling.clone();s.CreateAndStartAnimation("boxscale",t,"scaling",10,2,e,i,0)},t.prototype.delete_mesh=function(){if(!this.isMeshSelected)return"no mesh selected";if(null!=this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){var i=e[t];i!==this.meshPicked&&this.deleteTheMesh(i)}this.meshesPicked=null}return this.deleteTheMesh(this.meshPicked),this.meshPicked=null,this.removeEditControl(),null},t.prototype.deleteTheMesh=function(t){e.SNAManager.getSNAManager().removeSNAs(t);var i=this.shadowGenerator.getShadowMap().renderList,n=i.indexOf(t);n>=0&&i.splice(n,1),this.deleteSPS(t),t.dispose()},t.prototype.mergeMeshes_old=function(){if(null!=this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){if(e[t]instanceof BABYLON.InstancedMesh)return"some of your meshes are instance meshes. cannot merge those"}this.meshesPicked.push(this.meshPicked);var i=this.meshesPicked,n=y.MergeMeshes(i,!1);this.meshesPicked.pop();this.meshPicked.position.multiplyByFloats(-1,-1,-1);return n.setPivotPoint(this.meshPicked.position.clone()),n.position=this.meshPicked.position.clone(),this.switchEditControl(n),this.animateMesh(n),null}return"please select two or more mesh"},t.prototype.mergeMeshes=function(){if(null!=this.meshesPicked){for(var t=0,e=this.meshesPicked;t<e.length;t++){var i=e[t];if(i instanceof BABYLON.InstancedMesh)return"some of your meshes are instance meshes. cannot merge those"}this.meshesPicked.push(this.meshPicked);for(var n=new Array(this.meshesPicked.length),s=0,a=0,o=this.meshesPicked;a<o.length;a++){var i=o[a];n[s]=i.position.clone(),s++,i.position.subtractInPlace(this.meshPicked.position)}var r=this.meshesPicked,l=y.MergeMeshes(r,!1);s=0;for(var h=0,u=this.meshesPicked;h<u.length;h++){var i=u[h];i.position=n[s],s++}return this.meshesPicked.pop(),l.position=this.meshPicked.position.clone(),this.switchEditControl(l),this.animateMesh(l),this.shadowGenerator.getShadowMap().renderList.push(l),this.multiUnSelectAll(),null}return"select two or more mesh"},t.prototype.csgOperation=function(t){if(null!=this.meshesPicked){if(this.meshesPicked.length>2)return"please select only two mesh";var e=u.FromMesh(this.meshPicked),i=u.FromMesh(this.meshesPicked[0]),n=void 0;if("subtract"===t)n=i.subtract(e);else if("intersect"===t)n=i.intersect(e);else{if("union"!==t)return"invalid operation";n=i.union(e)}var s=new Number(Date.now()).toString(),a=n.toMesh(s,this.meshesPicked[0].material,this.scene,!1);return null!=this.meshesPicked[0].parent&&(a.parent=this.meshesPicked[0].parent),this.multiUnSelectAll(),this.switchEditControl(a),this.animateMesh(a),null}return"please select two mesh"},t.prototype.physTypes=function(){console.log("BoxImpostor "+S.BoxImpostor),console.log("SphereImpostor "+S.SphereImpostor),console.log("PlaneImpostor "+S.PlaneImpostor),console.log("CylinderImpostor "+S.CylinderImpostor),console.log("MeshImpostor "+S.MeshImpostor),console.log("ParticleImpostor "+S.ParticleImpostor),console.log("HeightmapImpostor "+S.HeightmapImpostor)},t.prototype.getMeshPickedPhyParms=function(){return this.meshPickedPhyParms},t.prototype.setMeshPickedPhyParms=function(t){this.meshPickedPhyParms=t},t.prototype.savePhyParms=function(){void 0===this.meshPicked.physicsImpostor||null===this.meshPicked.physicsImpostor?this.meshPickedPhyParms=null:(this.meshPickedPhyParms=new V,this.meshPickedPhyParms.type=this.meshPicked.physicsImpostor.type,this.meshPickedPhyParms.mass=this.meshPicked.physicsImpostor.getParam("mass"),this.meshPickedPhyParms.friction=this.meshPicked.physicsImpostor.getParam("friction"),this.meshPickedPhyParms.restitution=this.meshPicked.physicsImpostor.getParam("restitution"),this.meshPicked.physicsImpostor.dispose(),this.meshPicked.physicsImpostor=null)},t.prototype.restorePhyParms=function(){this.resetPhysics(),null!=this.meshPickedPhyParms&&(this.meshPicked.physicsImpostor=new S(this.meshPicked,this.meshPickedPhyParms.type),this.meshPicked.physicsImpostor.setParam("mass",this.meshPickedPhyParms.mass),this.meshPicked.physicsImpostor.setParam("friction",this.meshPickedPhyParms.friction),this.meshPicked.physicsImpostor.setParam("restitution",this.meshPickedPhyParms.restitution),this.meshPickedPhyParms=null)},t.prototype.testPhysics=function(t){this.resetPhysics(),this.didPhysTest=!0,this.savePos=this.meshPicked.position.clone(),this.saveRot=this.meshPicked.rotationQuaternion.clone(),this.meshPicked.physicsImpostor=new S(this.meshPicked,t.type),this.meshPicked.physicsImpostor.setParam("mass",t.mass),this.meshPicked.physicsImpostor.setParam("friction",t.friction),this.meshPicked.physicsImpostor.setParam("restitution",t.restitution)},t.prototype.resetPhysics=function(){this.didPhysTest&&(this.didPhysTest=!1,this.meshPicked.position.copyFrom(this.savePos),this.meshPicked.rotationQuaternion.copyFrom(this.saveRot),this.meshPicked.physicsImpostor.dispose(),this.meshPicked.physicsImpostor=null)},t.prototype.setMeshVisibility=function(t){this.meshPicked.visibility=t},t.prototype.getMeshVisibility=function(){return this.meshPicked.visibility},t.prototype.setMeshColor=function(t,e,i){var n=this.scene.getMaterialByID(t);if(null==n)return"material not found";var s=r.FromHexString(i);if("diffuse"===e)n.diffuseColor=s;else if("emissive"===e)n.emissiveColor=s;else if("specular"===e)n.specularColor=s;else{if("ambient"!==e)return"invalid color type ["+e+"]";n.ambientColor=s}return null},t.prototype.getMatNames=function(){var t=new Array;if(this.isMeshSelected){if(this.meshPicked.material instanceof BABYLON.MultiMaterial){for(var e=this.meshPicked.material,i=0,n=e.subMaterials;i<n.length;i++){var s=n[i];t.push(s.id)}return t}return t.push(this.meshPicked.material.id),t}return null},t.prototype.getMaterialName=function(t){var e=this.scene.getMaterialByID(t);return null==e?null:e.name},t.prototype.getMaterialType=function(t){var e=this.scene.getMaterialByID(t);return null==e?null:e instanceof w?"standard material":"not standard material"},t.prototype.setMaterialBFC=function(t,e){var i=this.scene.getMaterialByID(t);if(null==i)return null;i.backFaceCulling=e},t.prototype.getMaterialBFC=function(t){var e=this.scene.getMaterialByID(t);return null==e?"material not found":e.backFaceCulling},t.prototype.cloneMaterial=function(t){var e=this.scene.getMaterialByID(t);if(null==e)return null;if(this.meshPicked.material instanceof BABYLON.MultiMaterial){var i=this.meshPicked.material;this.meshPicked.material=i.clone(e.name+"Clone",!0)}else this.meshPicked.material=e.clone(e.name+"Clone")},t.prototype.createText=function(){return new C("",this.scene).uid},t.prototype.getMatTexture=function(t,e){var i=this.scene.getMaterialByID(t);if(null==i)return null;var n=null,s=null;return"diffuse"==e&&null!=i.diffuseTexture?(n=i.diffuseTexture.uid,s=i.diffuseTexture.url):"ambient"==e&&null!=i.ambientTexture?(n=i.ambientTexture.uid,s=i.ambientTexture.url):"opacity"==e&&null!=i.opacityTexture?(n=i.opacityTexture.uid,s=i.opacityTexture.url):"reflection"==e&&null!=i.reflectionTexture?(n=i.reflectionTexture.uid,s=i.reflectionTexture.url):"emissive"==e&&null!=i.emissiveTexture?(n=i.emissiveTexture.uid,s=i.emissiveTexture.url):"specular"==e&&null!=i.specularTexture?(n=i.specularTexture.uid,s=i.specularTexture.url):"bump"==e&&null!=i.bumpTexture?(n=i.bumpTexture.uid,s=i.bumpTexture.url):(n=null,s=this.NO_TEXTURE),[n,s]},t.prototype.setMatTexture=function(t,e,i){var n=this.getTextureByID(i);if(null!=n){var s=this.scene.getMaterialByID(t);if(null==s)return;"diffuse"==e?s.diffuseTexture=n:"ambient"==e?s.ambientTexture=n:"opacity"==e?s.opacityTexture=n:"reflection"==e?s.reflectionTexture=n:"emissive"==e?s.emissiveTexture=n:"specular"==e?s.specularTexture=n:"bump"==e&&(s.bumpTexture=n)}},t.prototype.removeMatTexture=function(t,e){var i=this.scene.getMaterialByID(t);null!=i&&("diffuse"==e?i.diffuseTexture=null:"ambient"==e?i.ambientTexture=null:"opacity"==e?i.opacityTexture=null:"reflection"==e?i.reflectionTexture=null:"emissive"==e?i.emissiveTexture=null:"specular"==e?i.specularTexture=null:"bump"==e&&(i.bumpTexture=null))},t.prototype.setTextURL=function(t,e){var i=this.getTextureByID(t);i.name=e,i.updateURL(e)},t.prototype.setTextHScale=function(t,e){this.getTextureByID(t).uScale=e},t.prototype.getTextHScale=function(t){var e=this.getTextureByID(t);return Number(e.uScale).toString()},t.prototype.setTextVScale=function(t,e){this.getTextureByID(t).vScale=e},t.prototype.getTextVScale=function(t){var e=this.getTextureByID(t);return Number(e.vScale).toString()},t.prototype.setTextHO=function(t,e){this.getTextureByID(t).uOffset=e},t.prototype.getTextHO=function(t){var e=this.getTextureByID(t);return Number(e.uOffset).toString()},t.prototype.setTextVO=function(t,e){this.getTextureByID(t).vOffset=e},t.prototype.getTextVO=function(t){var e=this.getTextureByID(t);return Number(e.vOffset).toString()},t.prototype.setTextRot=function(t,e){this.getTextureByID(t).wAng=e*Math.PI/180},t.prototype.getTextRot=function(t){var e=this.getTextureByID(t);return Number(180*e.wAng/Math.PI).toString()},t.prototype.getTextures=function(){for(var t=this.scene.textures,e=[],i=0,n=t;i<n.length;i++){var s=n[i];e.push(s.name)}return e},t.prototype.getTextureByName=function(t){for(var e=this.scene.textures,i=0,n=e;i<n.length;i++){var s=n[i];if(s.name==t)return s}return null},t.prototype.getTextureByID=function(t){for(var e=this.scene.textures,i=0,n=e;i<n.length;i++){var s=n[i];if(s.uid==t)return s}return null},t.prototype.getMeshColor=function(t,e){var i=this.scene.getMaterialByID(t);return null==i?null:i instanceof BABYLON.StandardMaterial?"diffuse"===e?void 0!==i.diffuseColor?i.diffuseColor.toHexString():"#000000":"emissive"===e?void 0!==i.emissiveColor?i.emissiveColor.toHexString():"#000000":"specular"===e?void 0!==i.specularColor?i.specularColor.toHexString():"#000000":"ambient"===e?void 0!==i.ambientColor?i.ambientColor.toHexString():"#000000":(console.error("invalid color type ["+e+"]"),null):"#000000"},t.prototype.getMeshList=function(){for(var t=new Array,e=0,i=this.scene.meshes;e<i.length;e++){var n=i[e];n!=this.ground&&n!=this.avatar&&n!=this.skybox&&"EditControl"!=n.name&&t.push(n)}return t},t.prototype.selectMesh=function(t){var e=this.scene.getMeshByUniqueID(Number(t));this.isMeshSelected?this.switchEditControl(e):this.selectForEdit(e)},t.prototype.selectGround=function(){this.isMeshSelected?this.switchEditControl(this.ground):this.selectForEdit(this.ground),this.ground.unfreezeWorldMatrix()},t.prototype.unSelectGrnd=function(){this.removeEditControl()},t.prototype.getAttachedLight=function(){var t=this.meshPicked.getDescendants();if(0===t.length)return null;for(var e=null,i=0,n=t;i<n.length;i++){var s=n[i];if(s instanceof v){e=s;break}}if(null===e)return null;var a=new R;return a.diffuse=e.diffuse,a.specular=e.specular,a.range=e.range,a.radius=e.radius,a.intensity=e.intensity,e instanceof BABYLON.SpotLight&&(a.type="Spot",a.angle=e.angle,a.exponent=e.exponent),e instanceof BABYLON.PointLight&&(a.type="Point"),e instanceof BABYLON.DirectionalLight&&(a.type="Dir"),e instanceof BABYLON.HemisphericLight&&(a.type="Hemi",a.direction=e.direction,a.gndClr=e.groundColor),a},t.prototype.attachAlight=function(t){this.detachLight();var e=null,i=this.meshPicked.name+"-light";"Spot"===t.type?e=new BABYLON.SpotLight(i,D.Zero(),new D(0,-1,0),t.angle*Math.PI/180,t.exponent,this.scene):"Point"===t.type?e=new BABYLON.PointLight(i,D.Zero(),this.scene):"Dir"===t.type?e=new BABYLON.DirectionalLight(i,new D(0,-1,0),this.scene):"Hemi"===t.type&&(e=new BABYLON.HemisphericLight(i,t.direction,this.scene),e.groundColor=t.gndClr),null!==e&&(e.diffuse=t.diffuse,e.specular=t.specular,e.range=t.range,e.radius=t.radius,e.intensity=t.intensity,e.parent=this.meshPicked)},t.prototype.detachLight=function(){var t=this.meshPicked.getDescendants();if(0!==t.length){for(var e=null,i=0,n=t;i<n.length;i++){var s=n[i];if(s instanceof v){e=s;break}}null!==e&&(e.parent=null,e.setEnabled(!1),e.dispose())}},t.prototype.setTransOn=function(){this.editControl.setLocal(!this.spaceWorld),this.editControl.enableTranslation()},t.prototype.isTransOn=function(){return this.editControl.isTranslationEnabled()},t.prototype.setRotOn=function(){this.editControl.setLocal(!this.spaceWorld),this.editControl.enableRotation()},t.prototype.isRotOn=function(){return this.editControl.isRotationEnabled()},t.prototype.setScaleOn=function(){this.editControl.setLocal(!0),this.editControl.enableScaling()},t.prototype.isScaleOn=function(){return this.editControl.isScalingEnabled()},t.prototype.setFocusOnMesh=function(){this.isFocusOnAv&&(this.cc.stop(),this.saveAVcameraPos.copyFrom(this.mainCamera.position),this.isFocusOnAv=!1),this.focusOnMesh(this.meshPicked,25)},t.prototype.setFocusOnNothing=function(){this.isFocusOnAv&&(this.cc.stop(),this.saveAVcameraPos.copyFrom(this.mainCamera.position),this.isFocusOnAv=!1)},t.prototype.setSpace=function(t){return console.log("setSPace parm "+t),this.snapperOn?"Cannot switch space when snapper is on":("local"===t?this.setSpaceLocal(!0):this.setSpaceLocal(!1),null)},t.prototype.getSpace=function(){return this.isSpaceLocal()?"local":"world"},t.prototype.setSpaceLocal=function(t){return null==this.editControl||this.editControl.isScalingEnabled()||this.editControl.setLocal(t),this.spaceWorld=!t,null},t.prototype.isSpaceLocal=function(){return!this.spaceWorld},t.prototype.undo=function(){null!=this.editControl&&this.editControl.undo()},t.prototype.redo=function(){null!=this.editControl&&this.editControl.redo()},t.prototype.snapTrans=function(t){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapTransOn=t,null!=this.editControl&&(this.snapTransOn?(this.editControl.setTransSnap(!0),this.editControl.setTransSnapValue(this.snapTransValue)):this.editControl.setTransSnap(!1))},t.prototype.isSnapTransOn=function(){return this.snapTransOn},t.prototype.setSnapTransValue=function(t){isNaN(t)||this.editControl.setTransSnapValue(t)},t.prototype.snapRot=function(t){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapRotOn=t,null!=this.editControl&&(this.snapRotOn?(this.editControl.setRotSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue)):this.editControl.setRotSnap(!1))},t.prototype.isSnapRotOn=function(){return this.snapRotOn},t.prototype.setSnapRotValue=function(t){if(!isNaN(t)){var e=t*Math.PI/180;this.editControl.setRotSnapValue(e)}},t.prototype.isSnapScaleOn=function(){return this.snapScaleOn},t.prototype.setSnapScaleValue=function(t){isNaN(t)||this.editControl.setScaleSnapValue(t)},t.prototype.snapScale=function(t){if(this.snapperOn)return"Cannot change snapping mode when snapper is on";this.snapScaleOn=t,null!=this.editControl&&(this.snapScaleOn?(this.editControl.setScaleSnap(!0),this.editControl.setScaleSnapValue(this.snapScaleValue)):this.editControl.setScaleSnap(!1))},t.prototype.snapper=function(t){!this.spaceWorld&&t&&(this.spaceWorld=!0),this.snapperOn=t,null!=this.editControl&&(this.snapperOn?this.setSnapperOn():this.setSnapperOff())},t.prototype.setSnapperOn=function(){this.editControl.setRotSnap(!0),this.editControl.setTransSnap(!0),this.editControl.setScaleSnap(!0),this.editControl.setRotSnapValue(this.snapRotValue),this.editControl.setTransSnapValue(this.snapTransValue),this.editControl.setScaleSnapValue(this.snapScaleValue),this.snapToGlobal()},t.prototype.setSnapperOff=function(){this.editControl.setRotSnap(!1),this.editControl.setTransSnap(!1),this.editControl.setScaleSnap(!1)},t.prototype.isSnapperOn=function(){return this.snapperOn},t.prototype.snapToGlobal=function(){if(this.isMeshSelected){var t=Math.round(this.meshPicked.position.x/this.snapTransValue)*this.snapTransValue,e=Math.round(this.meshPicked.position.y/this.snapTransValue)*this.snapTransValue,i=Math.round(this.meshPicked.position.z/this.snapTransValue)*this.snapTransValue;this.meshPicked.position=new D(t,e,i);var n=this.meshPicked.rotationQuaternion.toEulerAngles(),s=Math.round(n.x/this.snapRotValue)*this.snapRotValue,a=Math.round(n.y/this.snapRotValue)*this.snapRotValue,o=Math.round(n.z/this.snapRotValue)*this.snapRotValue;this.meshPicked.rotationQuaternion=A.RotationYawPitchRoll(a,s,o)}},t.prototype.getSoundFiles=function(){return null},t.prototype.anyMeshSelected=function(){return this.isMeshSelected},t.prototype.getName=function(){return this.meshPicked.name},t.prototype.setName=function(t){this.meshPicked.name=t},t.prototype.getLocation=function(){return this.meshPicked.position},t.prototype.setLocation=function(t,e,i){isNaN(t)||isNaN(e)||isNaN(i)||this.isMeshSelected&&(this.meshPicked.position.x=t,this.meshPicked.position.y=e,this.meshPicked.position.z=i)},t.prototype.setRotation=function(t,e,i){isNaN(t)||isNaN(e)||isNaN(i)||this.isMeshSelected&&A.RotationYawPitchRollToRef(e*Math.PI/180,t*Math.PI/180,i*Math.PI/180,this.meshPicked.rotationQuaternion)},t.prototype.setScale=function(t,e,i){isNaN(t)||isNaN(e)||isNaN(i)||this.isMeshSelected&&(this.meshPicked.scaling.x=t,this.meshPicked.scaling.y=e,this.meshPicked.scaling.z=i)},t.prototype.getRotation=function(){var t=this.meshPicked.rotationQuaternion.toEulerAngles(),e=180/Math.PI;return t.multiplyByFloats(e,e,e)},t.prototype.getScale=function(){return this.meshPicked.scaling},t.prototype.bakeTransforms=function(){var t=this.meshPicked.position.clone();this.meshPicked.position.copyFromFloats(0,0,0),this.meshPicked.bakeCurrentTransformIntoVertices(),this.meshPicked.position=t,this.meshPicked.computeWorldMatrix(!0)},t.prototype.getSkelName=function(){return null==this.meshPicked.skeleton?null:this.meshPicked.skeleton.name},t.prototype.getSkeleton=function(){return null==this.meshPicked.skeleton?null:this.meshPicked.skeleton},t.prototype.getSkeltons=function(){return this.scene.skeletons},t.prototype.changeSkeleton=function(t){var e=!1,i=this.scene.skeletons;console.log("trying to swicth to "+t);for(var n=0,s=i;n<s.length;n++){var a=s[n];if(a.id+"-"+a.name===t){console.log("found skeleton. swicthing. "),this.meshPicked.skeleton=a,e=!0;break}}return e},t.prototype.cloneChangeSkeleton=function(t){for(var e=!1,i=this.scene.skeletons,n=0,s=i;n<s.length;n++){var a=s[n];if(a.id+"-"+a.name===t){console.log("found skeleton. swicthing. ");var o=new Number(Date.now()).toString(),r=a.clone(a.name,o);this.meshPicked.skeleton=r,e=!0;break}}return e},t.prototype.toggleSkelView=function(){if(null!=this.meshPicked.skeleton){var t=this.findSkelViewer(this.skelViewerArr,this.meshPicked);null===t?(t=new M(this.meshPicked.skeleton,this.meshPicked,this.scene),t.isEnabled=!0,this.skelViewerArr.push(t)):(this.delSkelViewer(this.skelViewerArr,t),t.dispose(),t=null)}},t.prototype.findSkelViewer=function(t,e){for(var i=0,n=t;i<n.length;i++){var s=n[i];if(s.mesh===e)return s}return null},t.prototype.delSkelViewer=function(t,e){var i=t.indexOf(e);i>=0&&t.splice(i,1)},t.prototype.animRest=function(){null!==this.meshPicked.skeleton&&void 0!==this.meshPicked.skeleton&&(this.scene.stopAnimation(this.meshPicked.skeleton),this.meshPicked.skeleton.returnToRest())},t.prototype.createAnimRange=function(t,e,i){this.meshPicked.skeleton.deleteAnimationRange(t,!1),this.meshPicked.skeleton.createAnimationRange(t,e,i)},t.prototype.delAnimRange=function(t,e){this.meshPicked.skeleton.deleteAnimationRange(t,e)},t.prototype.getAnimationRanges=function(){var t=this.meshPicked.skeleton;if(null!==t&&void 0!==t){return t.getAnimationRanges()}return null},t.prototype.printAnimCount=function(t){for(var e=t.bones,i=0,n=e;i<n.length;i++){var s=n[i];console.log(s.name+","+s.animations.length+" , "+s.animations[0].getHighestFrame()),console.log(s.animations[0])}},t.prototype.playAnimation=function(t,e,i){var n=this.meshPicked.skeleton;if(null!=n){var s=parseFloat(e);isNaN(s)&&(s=1),n.beginAnimation(t,i,s)}},t.prototype.stopAnimation=function(){null!=this.meshPicked.skeleton&&this.scene.stopAnimation(this.meshPicked.skeleton)},t.prototype.getSensorList=function(){return e.SNAManager.getSNAManager().getSensorList()},t.prototype.getActuatorList=function(){return e.SNAManager.getSNAManager().getActuatorList()},t.prototype.getSensorParms=function(t){return e.SNAManager.getSNAManager().getSensorParms(t)},t.prototype.getActuatorParms=function(t){return e.SNAManager.getSNAManager().getActuatorParms(t)},t.prototype.getSensors=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.sensors;return null==t&&(t=new Array),t},t.prototype.getActuators=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.actuators;return null==t&&(t=new Array),t},t.prototype.addSensorbyName=function(t){return this.isMeshSelected?e.SNAManager.getSNAManager().createSensorByName(t,this.meshPicked,null):null},t.prototype.addActuaorByName=function(t){return this.isMeshSelected?e.SNAManager.getSNAManager().createActuatorByName(t,this.meshPicked,null):null},t.prototype.add_sensor=function(t,i){if(!this.isMeshSelected)return"no mesh selected";if("Touch"!==t)return"No such sensor";new e.SensorTouch(this.meshPicked,i);return null},t.prototype.addActuator=function(t,i){if(!this.isMeshSelected)return"no mesh selected";if("Rotator"===t)new e.ActuatorRotator(this.meshPicked,i);else{if("Mover"!==t)return"No such actuator";new e.ActuatorMover(this.meshPicked,i)}return null},t.prototype.removeSensor=function(t){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked.sensors;if(null==e)return"no sensor found";var i=e[t];return null==i?"no sensor found":(i.dispose(),null)},t.prototype.removeActuator=function(t){if(!this.isMeshSelected)return"no mesh selected";var e=this.meshPicked.actuators;if(null==e)return"no actuator found";var i=e[t];return null==i?"no actuator found":(i.dispose(),null)},t.prototype.removeSensorActuator=function(t){t.dispose()},t.prototype.setSunPos=function(t){var e=Math.PI*(180-t)/180,i=-Math.cos(e),n=-Math.sin(e);this.sunDR.direction=new D(i,n,0),this.sun.direction=new D(-i,-n,0)},t.prototype.getSunPos=function(){var t=this.sunDR.direction,e=t.x,i=t.y,n=Math.sqrt(e*e+i*i);return 180*Math.acos(e/n)/Math.PI},t.prototype.setLight=function(t){this.sun.intensity=t,this.sunDR.intensity=t,this.skybox.visibility=2*t},t.prototype.getLight=function(){return this.sun.intensity},t.prototype.setShade=function(t){var e=t;e=1-e,this.sun.groundColor=new r(e,e,e)},t.prototype.getShade=function(){return 1-this.sun.groundColor.r},t.prototype.setFog=function(t){this.scene.fogDensity=t},t.prototype.getFog=function(){return this.scene.fogDensity},t.prototype.setFogColor=function(t){this.scene.fogColor=r.FromHexString(t)},t.prototype.getFogColor=function(){return this.scene.fogColor.toHexString()},t.prototype.setFov=function(t){var e=t;this.mainCamera.fov=3.14*e/180},t.prototype.getFov=function(){return 180*this.mainCamera.fov/3.14},t.prototype.setSky=function(t){var e=this.skybox.material;e.reflectionTexture.dispose();var i="vishva/internal/assets/skyboxes/"+t+"/"+t;e.reflectionTexture=new h(i,this.scene),e.reflectionTexture.coordinatesMode=C.SKYBOX_MODE},t.prototype.getSky=function(){var t=this.skybox.material,e=t.reflectionTexture.name,i=e.lastIndexOf("/");return e.substring(i+1)},t.prototype.getAmbientColor=function(){return this.scene.ambientColor.toHexString()},t.prototype.setAmbientColor=function(t){this.scene.ambientColor=r.FromHexString(t)},t.prototype.isGroundPicked=function(){return!!this.isMeshSelected&&this.meshPicked==this.ground},
t.prototype.getGrndSPSbyID=function(t){for(var e=0,i=this.GroundSPSs;e<i.length;e++){var n=i[e];if(n.id==t)return n}return null},t.prototype.createGrndSPS=function(){if(null==this.meshesPicked)return"select a mesh to spread - use ctl-right click to select";if(this.meshesPicked.length>1)return"more than one mesh selected to spread - select only one";var t=this.meshesPicked[0];return new g(t.name+"-SPS",this,t,this.ground,{})},t.prototype.getMeshSpreadDtls=function(t){var e,i=this.scene.getMeshByID(t);return null==i?"no mesh found with id : "+t:(e=new g(i.name+"-SPS",this,i,this.ground,{}),e.getSpreadDtls())},t.prototype.updateSPSArray=function(t){null==this.GroundSPSs&&(this.GroundSPSs=new Array),this.GroundSPSs.push(t)},t.prototype.deleteSPS=function(t){if(null!=this.GroundSPSs)for(var e=0,i=0,n=this.GroundSPSs;i<n.length;i++){var s=n[i];console.log(s),s.spsMesh==t&&(console.log("removing sps"),this.GroundSPSs.splice(e,1),s.sps.dispose()),e++}},t.prototype.getGrndSPSList=function(){var t=new Array;if(null==this.GroundSPSs)return t;for(var e=0,i=this.GroundSPSs;e<i.length;e++){var n=i[e];t.push({id:n.id,desc:n.name})}return t},t.prototype.spreadOnGround=function(){if(!this.isMeshSelected)return"no mesh selected";var t=100*Math.random(),e={seed:t,step:5,posMax:new D(5,-1,5)},i=new g("sps",this,this.meshPicked,this.ground,e);return null==this.GroundSPSs&&(this.GroundSPSs=new Array),this.GroundSPSs.push(i),null},t.prototype.toggleDebug=function(){this.debugVisible?this.scene.debugLayer.hide():this.scene.debugLayer.show(),this.debugVisible=!this.debugVisible},t.prototype.saveAsset=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.position.clone(),e=this.meshPicked.rotation.clone(),i=this.meshPicked.rotationQuaternion.clone();this.meshPicked.position=D.Zero(),this.meshPicked.rotation=D.Zero();var n=k.SerializeMesh(this.meshPicked,!1,!0);this.meshPicked.position=t,this.meshPicked.rotation=e,this.meshPicked.rotationQuaternion=i;var s=JSON.stringify(n),a=new File([s],"AssetFile.babylon");return URL.createObjectURL(a)},t.prototype.saveAsset_old=function(){if(!this.isMeshSelected)return null;var t=this.meshPicked.clone(this.meshPicked.name,null,!1);t.position=D.Zero(),t.rotation=D.Zero();var e=k.SerializeMesh(this.meshPicked,!1,!0);t.dispose();var i=JSON.stringify(e),n=new File([i],"AssetFile.babylon");return URL.createObjectURL(n)},t.prototype.saveWorld=function(){if(null!=this.editControl)return alert("cannot save during edit"),null;this.removeInstancesFromShadow(),this.renameMeshIds(),this.cleanupSkels(),this.resetSkels(this.scene),this.cleanupMats(),this.renameWorldTextures();var t=new e.VishvaSerialized;if(t.settings.cameraCollision=this._cameraCollision,t.settings.autoEditMenu=this.autoEditMenu,t.guiSettings=this.vishvaGUI.getSettings(),t.misc.activeCameraTarget=this.mainCamera.target,null!=this.GroundSPSs){t.groundSPSserializeds=new Array;for(var i=0,n=this.GroundSPSs;i<n.length;i++){var s=n[i];console.log("saving"),console.log(s),t.groundSPSserializeds.push(s.serialize())}}t.snas=e.SNAManager.getSNAManager().serializeSnAs(this.scene);var a=k.Serialize(this.scene);a.VishvaSerialized=t;var o=JSON.stringify(a),r=new File([o],"WorldFile.babylon");return this.addInstancesToShadow(),URL.createObjectURL(r)},t.prototype.removeInstancesFromShadow=function(){for(var t=this.scene.meshes,e=0,i=t;e<i.length;e++){var n=i[e];if(null!=n&&n instanceof BABYLON.InstancedMesh){var s=this.shadowGenerator.getShadowMap().renderList,a=s.indexOf(n);a>=0&&s.splice(a,1)}}},t.prototype.addInstancesToShadow=function(){for(var t=0,e=this.scene.meshes;t<e.length;t++){var i=e[t];null!=i&&i instanceof BABYLON.InstancedMesh&&this.shadowGenerator.getShadowMap().renderList.push(i)}},t.prototype.renameMeshIds=function(){for(var t=0,e=0,i=this.scene.meshes;e<i.length;e++){i[e].id=new Number(t).toString(),t++}},t.prototype.resetSkels=function(t){for(var e=0,i=0,n=t.skeletons;i<n.length;i++){var s=n[i];s.id=new Number(e).toString(),e++,s.returnToRest()}},t.prototype.renameWorldTextures=function(){var t=this.scene.materials;this.renameWorldMaterials(t);for(var e=this.scene.multiMaterials,i=0,n=e;i<n.length;i++){var s=n[i];this.renameWorldMaterials(s.subMaterials)}},t.prototype.renameWorldMaterials=function(t){for(var e,i=0,n=t;i<n.length;i++){var s=n[i];null!=s&&s instanceof BABYLON.StandardMaterial&&(e=s,this.rename(e.diffuseTexture),this.rename(e.reflectionTexture),this.rename(e.opacityTexture),this.rename(e.specularTexture),this.rename(e.bumpTexture),this.rename(e.ambientTexture))}},t.prototype.rename=function(t){null!=t&&(t.name=this.RELATIVE_ASSET_LOCATION+t.url)},t.prototype.changeSoundUrl=function(t){var e=t.sounds;if(null!=e)for(var i=e,n=0,s=i;n<s.length;n++){var a=s[n];a.url=this.SOUND_ASSET_LOCATION+a.url}},t.prototype.cleanupMats=function(){for(var t=this.scene.meshes,e=new Array,i=new Array,n=0,s=t;n<s.length;n++){var a=s[n];if(null!=a.material)if(null!=a.material&&a.material instanceof BABYLON.MultiMaterial){var o=a.material;i.push(o);for(var r=o.subMaterials,l=0,h=r;l<h.length;l++){var u=h[l];e.push(u)}}else e.push(a.material)}for(var c=this.scene.materials,p=c.length,d=p-1;d>=0;d--)-1===e.indexOf(c[0|d])&&c[0|d].dispose();var g=this.scene.multiMaterials;p=g.length;for(var d=p-1;d>=0;d--)-1===i.indexOf(g[0|d])&&g[0|d].dispose()},t.prototype.cleanupSkels=function(){for(var t=this.scene.meshes,e=new Array,i=0,n=t;i<n.length;i++){var s=n[i];null!=s.skeleton&&e.push(s.skeleton)}for(var a=this.scene.skeletons,o=a.length,r=o-1;r>=0;r--)-1===e.indexOf(a[0|r])&&a[0|r].dispose()},t.prototype.loadAssetFile=function(t){var e=this,i=t.name.split(".")[0];I.ImportMesh("","vishva/assets/"+i+"/",t.name,this.scene,function(t,i,n){return e.onMeshLoaded(t,i,n)})},t.prototype.loadAsset=function(t,e){var i=this;this.filePath=t,this.file=e;var n=e.split(".")[0];I.ImportMesh("","vishva/assets/"+t+"/"+n+"/",e,this.scene,function(t,e,n){return i.onMeshLoaded(t,e,n)})},t.prototype.loadAsset2=function(t,e){var i=this;this.filePath=t,this.file=e,I.ImportMesh("","vishva/"+t,e,this.scene,function(t,e,n){return i.onMeshLoaded(t,e,n)})},t.prototype.onMeshLoaded=function(t,e,i){for(var n=this.getBoundingRadius(t),s=0,a=i;s<a.length;s++){var o=a[s];this.scene.stopAnimation(o)}for(var r=0,l=t;r<l.length;r++){var h=l[r];if(h.isPickable=!0,null==h.parent){var u=new D(0,0,-(n+2)),c=D.TransformCoordinates(u,this.avatar.getWorldMatrix());h.position.addInPlace(c)}this.shadowGenerator.getShadowMap().renderList.push(h),this.scene.stopAnimation(h),null!=h.skeleton&&(this.scene.stopAnimation(h.skeleton),this.fixAnimationRanges(h.skeleton))}this._postLoad(t)},t.prototype._postLoad=function(t){if(t.length>0){for(var e=0,i=t;e<i.length;e++){var n=i[e];this._makeMatIdUnique(n)}var s=t[t.length-1];this.isMeshSelected?this.switchEditControl(s):this.selectForEdit(s),this.animateMesh(s)}},t.prototype._makeMatIdUnique=function(t){var e=t;if(null!=e.material)if(e.material instanceof BABYLON.MultiMaterial)for(var i=e.material,n=i.subMaterials,s=0,a=n;s<a.length;s++){var o=a[s];o.id=this.uid()}else e.material.id=this.uid()},t.prototype.uid=function(){var t=Date.now(),e="";return t==this.prevUid?(e=new Number(this.uidPlus).toString(),this.uidPlus++):this.prevUid=t,new Number(t).toString()+e},t.prototype._renameTextures=function(t){if(null!=t.material)if(t.material instanceof BABYLON.MultiMaterial)for(var e=t.material,i=e.subMaterials,n=0,s=i;n<s.length;n++){var a=s[n];null!=a&&a instanceof BABYLON.StandardMaterial&&this.renameAssetTextures(a)}else{var o=t.material;this.renameAssetTextures(o)}},t.prototype.renameAssetTextures=function(t){this.renameAssetTexture(t.diffuseTexture),this.renameAssetTexture(t.reflectionTexture),this.renameAssetTexture(t.opacityTexture),this.renameAssetTexture(t.specularTexture),this.renameAssetTexture(t.bumpTexture)},t.prototype.renameAssetTexture=function(t){if(null!=t){var e=t.name;console.log("renaming "+e),0!==e.indexOf("vishva/")&&0!==e.indexOf("../")&&(t.name=t.url)}},t.prototype.getBoundingRadius=function(t){for(var e=0,i=0,n=t;i<n.length;i++){var s=n[i];null!=s.parent&&console.log("parent "+s.parent.name);var a=s.getBoundingInfo(),o=a.boundingSphere.radiusWorld;if(isFinite(o)){var r=o+s.absolutePosition.length();e<r&&(e=r)}}return e},t.prototype.loadWorldFile=function(t){var e=this;this.sceneFolderName=t.name.split(".")[0];var i=new FileReader;i.onload=function(t){return e.onSceneFileRead(t)},i.readAsText(t)},t.prototype.onSceneFileRead=function(t){var e=this;return this.sceneData="data:"+t.target.result,this.engine.stopRenderLoop(),this.scene.onDispose=function(){return e.onSceneDispose()},this.scene.dispose(),null},t.prototype.onSceneDispose=function(){var t=this;this.scene=null,this.avatarSkeleton=null,this.avatar=null,I.Load("worlds/"+this.sceneFolderName+"/",this.sceneData,this.engine,function(e){return t.onSceneLoaded(e)})},t.prototype.createWater=function(){console.log("creating water");var t=new E("water",this.scene);t.backFaceCulling=!0,t.bumpTexture=new C(this.waterTexture,this.scene),t.bumpTexture.name=this.RELATIVE_ASSET_LOCATION+t.bumpTexture.name,t.windForce=-5,t.waveHeight=.5,t.colorBlendFactor=0,t.bumpHeight=.1,t.waveLength=.1,t.addToRenderList(this.skybox),this.waterMesh=y.CreateGround("waterMesh",1024,1024,32,this.scene,!1),this.waterMesh.material=t},t.prototype.addWater=function(){if(!this.isMeshSelected)return"no mesh selected";var t=new E("water",this.scene);t.bumpTexture=new C(this.waterTexture,this.scene),t.windForce=.1,t.waveHeight=.1,t.colorBlendFactor=0,t.bumpHeight=0,t.waveLength=0,t.addToRenderList(this.skybox),this.meshPicked.material=t},t.prototype.switchAvatar=function(){return this.isMeshSelected?this.isAvatar(this.meshPicked)?(this.cc.stop(),e.SNAManager.getSNAManager().enableSnAs(this.avatar),this.avatar.rotationQuaternion=A.RotationYawPitchRoll(this.avatar.rotation.y,this.avatar.rotation.x,this.avatar.rotation.z),this.avatar.isPickable=!0,T.RemoveTagsFrom(this.avatar,"Vishva.avatar"),null!=this.avatarSkeleton&&(T.RemoveTagsFrom(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name=""),this.avatar=this.meshPicked,this.avatarSkeleton=this.avatar.skeleton,T.AddTagsTo(this.avatar,"Vishva.avatar"),null!=this.avatarSkeleton&&(T.AddTagsTo(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name="Vishva.skeleton",this.avatarSkeleton.enableBlending(this._animBlend)),this.cc.setAvatar(this.avatar),this.cc.setAvatarSkeleton(this.avatarSkeleton),this.avatar.checkCollisions=!0,this.avatar.ellipsoid=this._avEllipsoid,this.avatar.ellipsoidOffset=this._avEllipsoidOffset,this.avatar.isPickable=!1,this.avatar.rotation=this.avatar.rotationQuaternion.toEulerAngles(),this.avatar.rotationQuaternion=null,this.saveAVcameraPos=this.mainCamera.position,this.isFocusOnAv=!0,this.removeEditControl(),e.SNAManager.getSNAManager().disableSnAs(this.avatar),this.cc.setAvatar(this.avatar),this.cc.setAvatarSkeleton(this.avatarSkeleton),this.cc.start(),null):"cannot use this as avatar":"no mesh selected"},t.prototype.isAvatar=function(t){return null!=t.skeleton},t.prototype.createGround=function(t){var e=new w("groundMat",t);e.diffuseTexture=new C(this.groundTexture,t),e.bumpTexture=new C(this.groundBumpTexture,t),e.diffuseTexture.uScale=6,e.diffuseTexture.vScale=6,e.bumpTexture.uScale=100,e.bumpTexture.vScale=100,e.diffuseColor=new r(.9,.6,.4),e.specularColor=new r(0,0,0);var i=y.CreateGround("ground",256,256,1,t);return i.material=e,i.checkCollisions=!0,i.isPickable=!1,T.AddTagsTo(i,"Vishva.ground Vishva.internal"),i.freezeWorldMatrix(),i.receiveShadows=!0,this.enablePhysics&&(i.physicsImpostor=new BABYLON.PhysicsImpostor(i,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.1},this.scene)),this.ground=i,i},t.prototype.createGround_htmap=function(t){var e=this,i=this.createGroundMaterial(t);_.CreateGroundFromHeightMap("ground",this.groundHeightMap,{width:256,height:256,minHeight:0,maxHeight:20,subdivisions:32,updatable:!1,onReady:function(t){console.log("ground created"),t.material=i,t.checkCollisions=!0,t.isPickable=!1,T.AddTagsTo(t,"Vishva.ground Vishva.internal"),t.receiveShadows=!0,t.freezeWorldMatrix(),e.ground=t,e.spawnPosition.y=t.getHeightAtCoordinates(0,0)+5,null!=e.avatar&&(e.avatar.position=e.spawnPosition)}},t)},t.prototype.createGroundMaterial=function(t){var e=new w("groundMat",t);return e.diffuseTexture=new C(this.groundTexture,t),e.bumpTexture=new C(this.groundBumpTexture,t),e.diffuseTexture.uScale=25,e.diffuseTexture.vScale=25,e.bumpTexture.uScale=50,e.bumpTexture.vScale=50,e.specularColor=new r(0,0,0),e},t.prototype.onDataMapReady=function(t,e,i){var n=new Float32Array(t.length);p.ComputeNormalsFromMapToRef(t,e,i,n);var s={mapData:t,mapSubX:e,mapSubZ:i,mapNormals:n,terrainSub:120},a=new BABYLON.DynamicTerrain("t",s,this.scene),o=new w("tm",this.scene);o.diffuseTexture=new C(this.groundTexture,this.scene),o.diffuseTexture.uScale=6,o.diffuseTexture.vScale=6,o.bumpTexture=new C(this.groundBumpTexture,this.scene),o.bumpTexture.uScale=64,o.bumpTexture.vScale=64,o.specularColor=r.Black(),o.diffuseColor=new r(.9,.6,.4),a.mesh.material=o,a.createUVMap(),a.update(!0),a.mesh.checkCollisions=!0,this.ground=a.mesh,T.AddTagsTo(this.ground,"Vishva.ground Vishva.internal")},t.prototype.creatDynamicTerrain=function(){var t=this,e={width:1024,height:1024,subX:512,subZ:512,minHeight:0,maxHeight:10,offsetX:0,offsetZ:0,onReady:function(e,i,n){t.onDataMapReady(e,i,n)}},i=new Float32Array(786432);p.CreateMapFromHeightMapToRef(this.groundHeightMap,e,i,this.scene)},t.prototype.createSkyBox=function(t){var e=new w("skyBox",t);e.backFaceCulling=!1,e.disableLighting=!0,e.diffuseColor=new r(0,0,0),e.specularColor=new r(0,0,0),e.reflectionTexture=new h(this.skyboxTextures,t),e.reflectionTexture.coordinatesMode=C.SKYBOX_MODE;var i=y.CreateBox("skyBox",1e4,t);return i.material=e,i.infiniteDistance=!0,i.renderingGroupId=0,i.isPickable=!1,T.AddTagsTo(i,"Vishva.sky Vishva.internal"),i},t.prototype.toggleSnow=function(){null===this.snowPart&&(this.snowPart=this.createSnowPart()),this.snowing?this.snowPart.stop():(this.snowPart.start(),this.raining&&(this.rainPart.stop(),this.raining=!1)),this.snowing=!this.snowing},t.prototype.toggleRain=function(){null===this.rainPart&&(this.rainPart=this.createRainPart()),this.raining?this.rainPart.stop():(this.rainPart.start(),this.snowing&&(this.snowPart.stop(),this.snowing=!1)),this.raining=!this.raining},t.prototype.createSnowPart=function(){var t=new b("snow",4e3,this.scene);return t.particleTexture=new BABYLON.Texture(this.snowTexture,this.scene),t.emitter=new y("snowEmitter",this.scene,this.mainCamera),t.maxEmitBox=new D(100,40,100),t.minEmitBox=new D(-100,40,-100),t.emitRate=1e3,t.updateSpeed=.005,t.minLifeTime=1,t.maxLifeTime=5,t.minSize=.1,t.maxSize=.5,t.color1=new BABYLON.Color4(1,1,1,1),t.color2=new BABYLON.Color4(1,1,1,1),t.colorDead=new BABYLON.Color4(0,0,0,0),t.gravity=new BABYLON.Vector3(0,-9.81,0),t},t.prototype.createRainPart=function(){var t=new b("rain",4e3,this.scene);return t.particleTexture=new BABYLON.Texture(this.rainTexture,this.scene),t.emitter=new y("rainEmitter",this.scene,this.mainCamera),t.maxEmitBox=new D(100,40,100),t.minEmitBox=new D(-100,40,-100),t.emitRate=1e3,t.updateSpeed=.02,t.minLifeTime=5,t.maxLifeTime=10,t.minSize=.1,t.maxSize=.8,t.color1=new BABYLON.Color4(1,1,1,.5),t.color2=new BABYLON.Color4(0,0,1,1),t.colorDead=new BABYLON.Color4(0,0,0,0),t.gravity=new BABYLON.Vector3(0,-9.81,0),t},t.prototype.createParticles=function(t){if(null==this.meshPicked)return"no mesh selected";var e=null;"fire"==t?e=this._createFirePart():"smoke"==t&&(e=this._createSmokePart()),null!=e&&(e.emitter=this.meshPicked,e.start())},t.prototype._createFirePart=function(){var t=new BABYLON.ParticleSystem("particles",2e3,this.scene);return t.particleTexture=new BABYLON.Texture("vishva/internal/assets/particles/fire/flare.png",this.scene),t.emitter=this.meshPicked,t.minEmitBox=new BABYLON.Vector3(-.5,1,-.5),t.maxEmitBox=new BABYLON.Vector3(.5,1,.5),t.color1=new BABYLON.Color4(1,.5,0,1),t.color2=new BABYLON.Color4(1,.5,0,1),t.colorDead=new BABYLON.Color4(0,0,0,0),t.minSize=.3,t.maxSize=1,t.minLifeTime=.2,t.maxLifeTime=.4,t.emitRate=600,t.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,t.gravity=new BABYLON.Vector3(0,0,0),t.direction1=new BABYLON.Vector3(0,4,0),t.direction2=new BABYLON.Vector3(0,4,0),t.minAngularSpeed=0,t.maxAngularSpeed=Math.PI,t.minEmitPower=1,t.maxEmitPower=3,t.updateSpeed=.007,t},t.prototype._createSmokePart=function(){var t=new BABYLON.ParticleSystem("particles",1e3,this.scene);return t.particleTexture=new BABYLON.Texture("vishva/internal/assets/particles/smoke/flare.png",this.scene),t.minEmitBox=new BABYLON.Vector3(-.5,1,-.5),t.maxEmitBox=new BABYLON.Vector3(.5,1,.5),t.color1=new BABYLON.Color4(.02,.02,.02,.02),t.color2=new BABYLON.Color4(.02,.02,.02,.02),t.colorDead=new BABYLON.Color4(0,0,0,0),t.minSize=1,t.maxSize=3,t.minLifeTime=.3,t.maxLifeTime=1.5,t.emitRate=350,t.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,t.gravity=new BABYLON.Vector3(0,0,0),t.direction1=new BABYLON.Vector3(-1.5,8,-1.5),t.direction2=new BABYLON.Vector3(1.5,8,1.5),t.minAngularSpeed=0,t.maxAngularSpeed=Math.PI,t.minEmitPower=.5,t.maxEmitPower=1.5,t.updateSpeed=.005,t},t.prototype.createCamera=function(t,e){var i=new a("v.c-camera",1,1.4,4,new D(0,1e3,0),t);return this.setCameraSettings(i),i.attachControl(e,!0),null!==this.avatar&&void 0!==this.avatar&&(i.target=new D(this.avatar.position.x,this.avatar.position.y+1.5,this.avatar.position.z),i.alpha=-this.avatar.rotation.y-4.69),i.checkCollisions=this._cameraCollision,i.collisionRadius=this._cameraEllipsoid,T.AddTagsTo(i,"Vishva.camera"),i},t.prototype.createAvatar=function(){var t=this;I.ImportMesh("",this.avatarFolder,this.avatarFile,this.scene,function(e,i,n){return t.onAvatarLoaded(e,i,n)})},t.prototype.onAvatarLoaded=function(t,e,i){this.avatar=t[0],this.shadowGenerator.getShadowMap().renderList.push(this.avatar);for(var s=t.length,a=1;a<s;a++)t[a].checkCollisions=!1,t[a].dispose();this.avatarSkeleton=i[0],s=i.length;for(var a=1;a<s;a++)i[a].dispose();this.fixAnimationRanges(this.avatarSkeleton),this.avatar.skeleton=this.avatarSkeleton,this.avatarSkeleton.enableBlending(this._animBlend),this.avatar.position=this.spawnPosition,this.avatar.checkCollisions=!0,this.avatar.ellipsoid=this._avEllipsoid,this.avatar.ellipsoidOffset=this._avEllipsoidOffset,this.avatar.isPickable=!1,T.AddTagsTo(this.avatar,"Vishva.avatar"),T.AddTagsTo(this.avatarSkeleton,"Vishva.skeleton"),this.avatarSkeleton.name="Vishva.skeleton",this.mainCamera.alpha=-this.avatar.rotation.y-4.69;var o=this.avatar.material;if(null!=o.diffuseTexture){var l=o.diffuseTexture.name;o.diffuseTexture.name=this.avatarFolder+l,o.backFaceCulling=!0,o.ambientColor=new r(0,0,0)}this.cc=new n(this.avatar,this.mainCamera,this.scene),this.setCharacterController(this.cc),this.cc.setCameraElasticity(!0),this.cc.start()},t.prototype.disableAV=function(){this.cc.stop(),this.avatar.checkCollisions=!1,this.scene.stopAnimation(this.avatar.skeleton),this._avDisabled=!0},t.prototype.enableAV=function(){this.scene.stopAnimation(this.avatar.skeleton),this.cc.start(),this.avatar.checkCollisions=!0,this._avDisabled=!1},t.prototype.setCharacterController=function(t){this.mainCamera.lowerRadiusLimit=1,this.mainCamera.upperRadiusLimit=100,t.setCameraTarget(new BABYLON.Vector3(0,1.5,0)),t.setIdleAnim("idle",1,!0),t.setTurnLeftAnim("turnLeft",.5,!0),t.setTurnRightAnim("turnRight",.5,!0),t.setWalkBackAnim("walkBack",.5,!0),t.setJumpAnim("jumpRun",.5,!0),t.setFallAnim("fall",2,!1),t.setSlideBackAnim("slideBack",1,!1),t.setTurnRightKey("E"),t.setTurnLeftKey("Q"),t.setStrafeRightKey("D"),t.setStrafeLeftKey("A"),t.setTurnRightCode(0),t.setTurnLeftCode(0),t.setStrafeRightCode(39),t.setStrafeLeftCode(37),t.setStepOffset(.5),t.setSlopeLimit(30,60)},t.prototype.fixAnimationRanges=function(t){for(var e=t.getAnimationRanges(),i=0,n=e;i<n.length;i++){n[i].from++}},t.prototype.setCameraSettings=function(t){t.lowerRadiusLimit=.25,t.keysLeft=[],t.keysRight=[],t.keysUp=[],t.keysDown=[],t.panningInertia=.1,t.inertia=.1,t.panningSensibility=250,t.angularSensibilityX=250,t.angularSensibilityY=250},t.prototype.backfaceCulling=function(t){var e;for(e=0;e<t.length;++e)t[e].backFaceCulling=!1},t.prototype.disableKeys=function(){this.keysDisabled=!0,this.cc.stop()},t.prototype.enableKeys=function(){this.keysDisabled=!1,this.isFocusOnAv&&this.cc.start()},t.prototype.enableCameraCollision=function(t){this._cameraCollision=t,this.mainCamera.checkCollisions=t,this.cc.cameraCollisionChanged()},t.prototype.isCameraCollisionOn=function(){return this._cameraCollision},t.prototype.enableAutoEditMenu=function(t){this.autoEditMenu=t},t.prototype.isAutoEditMenuOn=function(){return this.autoEditMenu},t}();e.Vishva=N;var L=function(){function t(){this.up=!1,this.down=!1,this.right=!1,this.left=!1,this.stepRight=!1,this.stepLeft=!1,this.jump=!1,this.trans=!1,this.rot=!1,this.scale=!1,this.esc=!1,this.shift=!1,this.ctl=!1,this.alt=!1,this.focus=!1}return t}();e.Key=L;var O=function(){function t(t,e,i){this.exist=!1,this.name=t,this.l=e,this.r=i}return t}();e.AnimData=O;var V=function(){function t(){}return t}();e.PhysicsParm=V;var R=function(){function t(){this.type="Spot",this.diffuse=r.White(),this.specular=r.White(),this.intensity=1,this.range=5,this.radius=5,this.angle=45,this.exponent=1,this.gndClr=r.White(),this.direction=D.Zero()}return t}();e.LightParm=R}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Vector3,i=function(){function t(){this.settings=new n,this.misc=new s}return t}();t.VishvaSerialized=i;var n=function(){function t(){this.cameraCollision=!0,this.autoEditMenu=!1}return t}();t.SettingsSerialized=n;var s=function(){function t(){this.activeCameraTarget=e.Zero()}return t}();t.MiscSerialized=s}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.Quaternion,n=BABYLON.Tags,s=BABYLON.Vector3,a=BABYLON.Vector2,o=t.ssatguru.babylonjs.vishva.gui.FileInputType,r=t.ssatguru.babylonjs.vishva.gui.Range,l=function(){function t(){this.sensorList=[],this.actuatorList=[],this.actuatorMap={},this.sensorMap={},this.snaDisabledList=new Array,this.sig2actMap=new Object,this.prevUID=""}return t.getSNAManager=function(){return null==t.sm&&(t.sm=new t),t.sm},t.prototype.addActuator=function(t,e){this.actuatorList.push(t),this.actuatorMap[t]=e},t.prototype.addSensor=function(t,e){this.sensorList.push(t),this.sensorMap[t]=e},t.prototype.setConfig=function(t){this.sensors=t.sensors,this.actuators=t.actuators,this.sensorList=Object.keys(this.sensors),this.actuatorList=Object.keys(this.actuators)},t.prototype.getSensorList=function(){return this.sensorList},t.prototype.getActuatorList=function(){return this.actuatorList},t.prototype.createSensorByName=function(t,e,i){return new(0,this.sensorMap[t])(e,i)},t.prototype.createActuatorByName=function(t,e,i){return new(0,this.actuatorMap[t])(e,i)},t.prototype.getSensorParms=function(t){return this.sensors[t].parms},t.prototype.getActuatorParms=function(t){return this.sensors[t].parms},t.prototype.emitSignal=function(t){if(""!==t.trim()){var e=this.sig2actMap[t];if(null!=e)for(var i=0,n=e;i<n.length;i++){var s=n[i];s.start(t)}}},t.prototype.processQueue=function(t){var e=t.actuators;if(null!=e)for(var i=0,n=e;i<n.length;i++){var s=n[i];s.processQueue()}},t.prototype.disableSnAs=function(t){this.snaDisabledList.push(t);var e=t.actuators;if(null!=e)for(var i=0,n=e;i<n.length;i++){var s=n[i];s.actuating&&s.stop()}},t.prototype.enableSnAs=function(t){var e=this.snaDisabledList.indexOf(t);-1!==e&&this.snaDisabledList.splice(e,1);var i=t.actuators;if(null!=i)for(var n=0,s=i;n<s.length;n++){var a=s[n];a.properties.autoStart&&a.start(a.properties.signalId)}},t.prototype.removeSNAs=function(t){var e=t.actuators;if(null!=e)for(var i=e.length,n=i-1;n>=0;n--)e[n].dispose();var s=t.sensors;if(null!=s)for(var i=s.length,n=i-1;n>=0;n--)s[n].dispose();var n=this.snaDisabledList.indexOf(t);-1!==n&&this.snaDisabledList.splice(n,1)},t.prototype.subscribe=function(t,e){var i=this.sig2actMap[e];if(null==i){var n=new Array;n.push(t),this.sig2actMap[e]=n}else{var n=i;-1==n.indexOf(t)&&n.push(t)}},t.prototype.unSubscribe=function(t,e){var i=this.sig2actMap[e];if(null!=i){var n=i,s=n.indexOf(t);-1!==s&&n.splice(s,1)}},t.prototype.unSubscribeAll=function(){},t.prototype.serializeSnAs=function(t){for(var e,i,n=new Array,s=t.meshes,a=0,o=s;a<o.length;a++){var r=o[a];i=null;var l=r.actuators;if(null!=l){i=this.getMeshVishvaUid(r);for(var u=0,c=l;u<c.length;u++){var p=c[u];e=new h,e.name=p.getName(),e.type=p.getType(),e.meshId=i,e.properties=p.getProperties(),n.push(e)}}var d=r.sensors;if(null!=d){null==i&&(i=this.getMeshVishvaUid(r));for(var g=0,m=d;g<m.length;g++){var v=m[g];e=new h,e.name=v.getName(),e.type=v.getType(),e.meshId=i,e.properties=v.getProperties(),n.push(e)}}}return n},t.prototype.unMarshal=function(t,e){var i=[];if(null!=t){for(var n=0,s=t;n<s.length;n++){var a=s[n],o=e.getMeshesByTags(a.meshId)[0];null==o&&null!=(o=e.getMeshByName(a.meshId))&&i.indexOf(o)<0&&i.push(o),null!=o?(this.unMarshalProps(a.properties),"SENSOR"===a.type?this.createSensorByName(a.name,o,a.properties):"ACTUATOR"===a.type&&this.createActuatorByName(a.name,o,a.properties)):console.error("Didnot find mesh for tag "+a.meshId)}for(var r=0,l=i;r<l.length;r++){var h=l[r];h.name=h.name.split(".Vishva.uid.")[0]}}},t.prototype.unMarshalProps=function(t){for(var e=Object.keys(t),n=0,l=e;n<l.length;n++){var h=l[n];if("object"==typeof t[h]){var u=t[h],c=Object.keys(u),p=c.length;if(c.indexOf("x")>=0)c.indexOf("y")>=0&&(c.indexOf("z")>=0?c.indexOf("w")>=0?4==p&&(t[h]=new i(u.x,u.y,u.z,u.w)):3==p&&(t[h]=new s(u.x,u.y,u.z)):2==p&&(t[h]=new a(u.x,u.y)));else if(c.indexOf("type")>=0)if("FileInputType"===u.type){var d=new o(u.tile,u.filter,u.openAll);d.value=u.value,t[h]=d}else if("Range"===u.type){var g=new r(u.min,u.max,u.value,u.step);t[h]=g}}}},t.prototype.getMeshVishvaUid=function(t){if(!(t instanceof BABYLON.InstancedMesh)&&n.HasTags(t))for(var e=n.GetTags(t,!0).split(" "),i=0,s=e;i<s.length;i++){var a=s[i],o=a.indexOf("Vishva.uid.");if(o>=0)return a}var r;for(r="Vishva.uid."+new Number(Date.now()).toString();r===this.prevUID;)r="Vishva.uid."+new Number(Date.now()).toString();return this.prevUID=r,t instanceof BABYLON.InstancedMesh?(t.name=t.name+"."+r,t.name):(n.AddTagsTo(t,r),r)},t.prototype.getAV=function(){return e.Vishva.vishva.avatar},t.prototype.disableAV=function(){e.Vishva.vishva.disableAV()},t.prototype.enableAV=function(){e.Vishva.vishva.enableAV()},t.prototype.getCamera=function(){return e.Vishva.vishva.mainCamera},t}();e.SNAManager=l;var h=function(){function t(){}return t}();e.SNAserialized=h;var u=function(){function t(t,e){this.actions=new Array,this.properties=e,this.mesh=t;var i=this.mesh.sensors;null==i&&(i=new Array,t.sensors=i),i.push(this)}return t.prototype.dispose=function(){var t=this.mesh.sensors;if(null!=t){var e=t.indexOf(this);-1!==e&&t.splice(e,1)}this.removeActions(),this.cleanUp()},t.prototype.getSignalId=function(){return this.properties.signalId},t.prototype.setSignalId=function(t){this.properties.signalId=t},t.prototype.emitSignal=function(t){l.getSNAManager().snaDisabledList.indexOf(this.mesh)>=0||l.getSNAManager().emitSignal(this.properties.signalId)},t.prototype.getProperties=function(){return this.properties},t.prototype.setProperties=function(t){this.properties=t},t.prototype.handlePropertiesChange=function(){this.removeActions(),this.onPropertiesChange()},t.prototype.getType=function(){return"SENSOR"},t.prototype.removeActions=function(){if(this.mesh.actionManager){for(var t,e=this.mesh.actionManager.actions,i=0,n=this.actions;i<n.length;i++){var s=n[i];t=e.indexOf(s),e.splice(t,1)}0===e.length&&(this.mesh.actionManager.dispose(),this.mesh.actionManager=null)}},t}();e.SensorAbstract=u;var c=function(){function t(t,e){this.actuating=!1,this.ready=!0,this.queued=0,this.disposed=!1,this.disabled=!1,this.stopped=!1,this.properties=e,this.mesh=t,this.handlePropertiesChange();var i=this.mesh.actuators;null==i&&(i=new Array,this.mesh.actuators=i),i.push(this)}return t.prototype.start=function(t){if(this.disposed)return!1;if(!this.ready)return!1;if(l.getSNAManager().snaDisabledList.indexOf(this.mesh)>=0)return!1;if(t==this.signalDisable)return!this.disabled&&(this.disabled=!0,this.queued=0,this.stopped=!0,this.stop(),!1);if(t==this.signalEnable)if(this.disabled=!1,0==this.queued){if(t!=this.signalId)return!1}else this.queued--;return!this.disabled&&(this.stopped=!1,this.actuating?(this.properties.loop||this.queued++,!0):(l.getSNAManager().emitSignal(this.properties.signalStart),this.actuating=!0,this.actuate(),!0))},t.prototype.processQueue=function(){this.queued>0&&(this.queued--,this.start(this.signalId))},t.prototype.getType=function(){return"ACTUATOR"},t.prototype.getMesh=function(){return this.mesh},t.prototype.getProperties=function(){return this.properties},t.prototype.setProperties=function(t){this.properties=t,this.handlePropertiesChange()},t.prototype.getSignalId=function(){return this.properties.signalId},t.prototype.handlePropertiesChange=function(){null!=this.properties.signalId&&""!=this.properties.signalId&&(null==this.signalId?(this.signalId=this.properties.signalId,l.getSNAManager().subscribe(this,this.signalId)):this.signalId!==this.properties.signalId&&(l.getSNAManager().unSubscribe(this,this.signalId),this.signalId=this.properties.signalId,l.getSNAManager().subscribe(this,this.signalId))),null!=this.properties.signalEnable&&""!=this.properties.signalEnable&&(null==this.signalEnable?(this.signalEnable=this.properties.signalEnable,l.getSNAManager().subscribe(this,this.signalEnable)):this.signalEnable!==this.properties.signalEnable&&(l.getSNAManager().unSubscribe(this,this.signalEnable),this.signalEnable=this.properties.signalEnable,l.getSNAManager().subscribe(this,this.signalEnable))),null!=this.properties.signalDisable&&""!=this.properties.signalDisable&&(null==this.signalDisable?(this.signalDisable=this.properties.signalDisable,l.getSNAManager().subscribe(this,this.signalDisable)):this.signalDisable!==this.properties.signalDisable&&(l.getSNAManager().unSubscribe(this,this.signalDisable),this.signalDisable=this.properties.signalDisable,l.getSNAManager().subscribe(this,this.signalDisable))),this.onPropertiesChange()},t.prototype.onActuateEnd=function(){if(l.getSNAManager().emitSignal(this.properties.signalEnd),this.actuating=!1,!this.disabled&&!this.stopped)return this.queued>0?(this.queued--,this.start(this.signalId),null):this.properties.loop?(this.start(this.signalId),null):null},t.prototype.dispose=function(){this.disposed=!0,l.getSNAManager().unSubscribe(this,this.properties.signalId);var t=this.mesh.actuators;if(null!=t){this.stop();var e=t.indexOf(this);-1!==e&&t.splice(e,1)}this.cleanUp(),this.mesh=null},t}();e.ActuatorAbstract=c;var p=function(){function t(){this.signalId="0",this.signalEnable="",this.signalDisable=""}return t}();e.SNAproperties=p;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.signalStart="",e.signalEnd="",e.autoStart=!1,e.loop=!1,e.toggle=!0,e.state_notReversed=!0,e}return __extends(e,t),e}(p);e.ActProperties=d}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));var org;!function(t){!function(e){!function(e){!function(e){var i=t.ssatguru.babylonjs.vishva.gui.SelectType,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animationRange=new i,e.rate=1,e}return __extends(e,t),e}(e.ActProperties);e.AnimatorProp=n;var s=function(t){function e(e,i){var s=this;s=null!=i?t.call(this,e,i)||this:t.call(this,e,new n)||this;var a=s.properties,o=e.skeleton;if(null!=o){
for(var r=o.getAnimationRanges(),l=new Array,h=0,u=0,c=r;u<c.length;u++){var p=c[u];null!=p&&(l[h]=p.name,h++)}a.animationRange.values=l}else a.animationRange.values=[""];return s}return __extends(e,t),e.prototype.actuate=function(){var t=this,e=this.properties;null!=this.mesh.skeleton&&this.mesh.skeleton.beginAnimation(e.animationRange.value,!1,e.rate,function(){return t.onActuateEnd()})},e.prototype.stop=function(){},e.prototype.isReady=function(){return!0},e.prototype.getName=function(){return"Animator"},e.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},e.prototype.cleanUp=function(){this.properties.loop=!1},e}(e.ActuatorAbstract);e.ActuatorAnimator=s}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Animator",org.ssatguru.babylonjs.vishva.ActuatorAnimator);var org;!function(t){!function(e){!function(e){!function(e){var i=t.ssatguru.babylonjs.vishva.gui.SelectType,n=BABYLON.Vector3,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.changeTrans=!0,e.position=new n(0,0,0),e.rotation=new n(0,0,0),e.makeChild=!0,e.focusOnAV=!0,e.focusPosition=new n(0,0,0),e.animationRange=new i,e.rate=1,e}return __extends(e,t),e}(e.ActProperties);e.AvAnimatorProp=s;var a=function(t){function i(e,i){var a=this;a=null!=i?t.call(this,e,i)||this:t.call(this,e,new s)||this,a._sp=new n(0,0,0),a._sr=new n(0,0,0),a._sct=new n(0,0,0),a._scp=new n(0,0,0);var o=a.properties,r=a.mesh.getScene(),l=r.getMeshesByTags("Vishva.avatar")[0],h=l.skeleton;if(null!=h){for(var u=h.getAnimationRanges(),c=new Array(u.length),p=0,d=0,g=u;d<g.length;d++){var m=g[d];c[p]=m.name,p++}o.animationRange.values=c}else o.animationRange.values=[""];return a}return __extends(i,t),i.prototype.actuate=function(){var t=this,i=this.properties;this.avMesh=e.SNAManager.getSNAManager().getAV();var n=this.avMesh.skeleton;if(null!=n){if(e.SNAManager.getSNAManager().disableAV(),this._sp.copyFrom(this.avMesh.position),this._sr.copyFrom(this.avMesh.rotation),i.makeChild?(this.avMesh.parent=this.mesh,i.changeTrans?(this.avMesh.position.copyFrom(i.position),this.avMesh.rotation.copyFrom(i.rotation)):this.avMesh.position.subtractInPlace(this.mesh.position)):i.changeTrans&&(this.mesh.position.addToRef(i.position,this.avMesh.position),this.avMesh.rotation.copyFrom(i.rotation)),i.focusOnAV){var s=e.SNAManager.getSNAManager().getCamera();this._scp.copyFrom(s.position),this._sct.copyFrom(s.target),s.setTarget(this.avMesh)}this.anim=n.beginAnimation(i.animationRange.value,i.loop,i.rate,function(){return t.onActuateEnd()})}},i.prototype.stop=function(){var t=this.properties;if(null!=this.anim&&this.anim.stop(),this.avMesh.parent=null,this.avMesh.position.copyFrom(this._sp),this.avMesh.rotation.copyFrom(this._sr),t.focusOnAV){var i=e.SNAManager.getSNAManager().getCamera();i.setPosition(this._scp.clone()),i.setTarget(this._sct.clone())}e.SNAManager.getSNAManager().enableAV()},i.prototype.isReady=function(){return!0},i.prototype.getName=function(){return"AvAnimator"},i.prototype.onPropertiesChange=function(){this.properties.autoStart&&this.start(this.properties.signalId)},i.prototype.cleanUp=function(){this.properties.loop=!1},i}(e.ActuatorAbstract);e.ActuatorAvAnimator=a}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("AvAnimator",org.ssatguru.babylonjs.vishva.ActuatorAvAnimator);var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Animation,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeToCloak=1,e}return __extends(e,t),e}(t.ActProperties);t.ActCloakerProp=i;var n=function(t){function n(e,n){var s=this;return s=null!=n?t.call(this,e,n)||this:t.call(this,e,new i)||this,s.s=1,s.e=0,s}return __extends(n,t),n.prototype.actuate=function(){var t=this,i=this.properties;i.toggle?(i.state_notReversed?(this.s=1,this.e=0):(this.s=0,this.e=1),i.state_notReversed=!i.state_notReversed):(this.s=1,this.e=0),this.a=e.CreateAndStartAnimation("cloaker",this.mesh,"visibility",60,60*i.timeToCloak,this.s,this.e,0,null,function(){return t.onActuateEnd()})},n.prototype.stop=function(){var t=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},n.prototype.isReady=function(){return!0},n.prototype.getName=function(){return"Cloaker"},n.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},n.prototype.cleanUp=function(){this.properties.loop=!1},n}(t.ActuatorAbstract);t.ActuatorCloaker=n}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Cloaker",org.ssatguru.babylonjs.vishva.ActuatorCloaker);var org;!function(t){!function(t){!function(t){!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.ActProperties);t.ActDisablerProp=e;var i=function(t){function i(i,n){return null!=n?t.call(this,i,n)||this:t.call(this,i,new e)||this}return __extends(i,t),i.prototype.actuate=function(){var t=!1;this.properties.toggle?(t=!this.properties.state_notReversed,this.properties.state_notReversed=!this.properties.state_notReversed):t=!1,this.mesh.setEnabled(t),this.disableChilds(this.mesh,t),this.onActuateEnd()},i.prototype.disableChilds=function(t,e){for(var i=t.getDescendants(!1),n=0,s=i;n<s.length;n++){s[n].setEnabled(e)}},i.prototype.stop=function(){this.mesh.setEnabled(!0)},i.prototype.isReady=function(){return!0},i.prototype.getName=function(){return"Disabler"},i.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},i.prototype.cleanUp=function(){this.properties.loop=!1},i}(t.ActuatorAbstract);t.ActuatorDisabler=i}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Disabler",org.ssatguru.babylonjs.vishva.ActuatorDisabler);var org;!function(t){!function(t){!function(t){!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.ActProperties);t.ActEnablerProp=e;var i=function(t){function i(i,n){return null!=n?t.call(this,i,n)||this:t.call(this,i,new e)||this}return __extends(i,t),i.prototype.actuate=function(){var t=!0;this.properties.toggle&&(t=this.properties.state_notReversed,this.properties.state_notReversed=!this.properties.state_notReversed),this.mesh.setEnabled(t),this.enableChilds(this.mesh,t),this.onActuateEnd()},i.prototype.enableChilds=function(t,e){for(var i=t.getDescendants(!1),n=0,s=i;n<s.length;n++){s[n].setEnabled(e)}},i.prototype.stop=function(){this.mesh.setEnabled(!0)},i.prototype.isReady=function(){return!0},i.prototype.getName=function(){return"Enabler"},i.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},i.prototype.cleanUp=function(){this.properties.loop=!1},i}(t.ActuatorAbstract);t.ActuatorEnabler=i}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Enabler",org.ssatguru.babylonjs.vishva.ActuatorEnabler);var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.Light,n=t.ssatguru.babylonjs.vishva.gui.SelectType,s=function(t){function e(){var e=t.call(this)||this;return e.switchType=new n,e.switchType.values=["OnSwitch","OffSwitch"],e.switchType.value="OnSwitch",e}return __extends(e,t),e}(e.ActProperties);e.ActLightProp=s;var a=function(t){function e(e,i){return null!=i?t.call(this,e,i)||this:t.call(this,e,new s)||this}return __extends(e,t),e.prototype.actuate=function(){var t=this.getLights(this.mesh);if(0==t.length)return void this.onActuateEnd();var e,i=this.properties;e="OnSwitch"==i.switchType.value,this.properties.toggle&&(this.properties.state_notReversed||(e=!e),this.properties.state_notReversed=!this.properties.state_notReversed),this.switchLights(t,e),this.onActuateEnd()},e.prototype.switchLights=function(t,e){for(var i=0,n=t;i<n.length;i++){n[i].setEnabled(e)}},e.prototype.getLights=function(t){for(var e=t.getDescendants(!1),n=[],s=0,a=e;s<a.length;s++){var o=a[s];o instanceof i&&n.push(o)}return n},e.prototype.stop=function(){var t=this.properties;t.switchType.value,this.switchLights(this.getLights(this.mesh),!0)},e.prototype.isReady=function(){return!0},e.prototype.getName=function(){return"Light"},e.prototype.onPropertiesChange=function(){this.properties.autoStart&&this.start(this.properties.signalId)},e.prototype.cleanUp=function(){this.properties.loop=!1},e}(e.ActuatorAbstract);e.ActuatorLight=a}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Light",org.ssatguru.babylonjs.vishva.ActuatorLight);var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Animation,i=BABYLON.Vector3,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=1,e.y=1,e.z=1,e.duration=1,e.local=!1,e}return __extends(e,t),e}(t.ActProperties);t.ActMoverParm=n;var s=function(t){function s(e,i){return null!=i?t.call(this,e,i)||this:t.call(this,e,new n)||this}return __extends(s,t),s.prototype.actuate=function(){var t,n,s=this,a=this.properties,o=this.mesh.position.clone();if(a.local){var r=this.mesh.getWorldMatrix(),l=new i(a.x*(1/this.mesh.scaling.x),a.y*(1/this.mesh.scaling.y),a.z*(1/this.mesh.scaling.z));n=i.TransformCoordinates(l,r).subtract(this.mesh.position)}else n=new i(a.x,a.y,a.z);a.toggle?(t=a.state_notReversed?o.add(n):o.subtract(n),a.state_notReversed=!a.state_notReversed):t=o.add(n),this.a=e.CreateAndStartAnimation("move",this.mesh,"position",60,60*a.duration,o,t,0,null,function(){return s.onActuateEnd()})},s.prototype.getName=function(){return"Mover"},s.prototype.stop=function(){var t=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},s.prototype.cleanUp=function(){},s.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},s.prototype.isReady=function(){return!0},s.prototype.newInstance=function(t,e){return new s(t,e)},s}(t.ActuatorAbstract);t.ActuatorMover=s}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Mover",org.ssatguru.babylonjs.vishva.ActuatorMover);var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.Animation,i=BABYLON.Axis,n=BABYLON.Quaternion,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=0,e.y=90,e.z=0,e.duration=1,e}return __extends(e,t),e}(t.ActProperties);t.ActRotatorParm=s;var a=function(t){function a(e,i){return null!=i?t.call(this,e,i)||this:t.call(this,e,new s)||this}return __extends(a,t),a.prototype.actuate=function(){var t,s=this,a=this.properties,o=this.mesh.rotationQuaternion.clone(),r=n.RotationAxis(i.X,a.x*Math.PI/180),l=n.RotationAxis(i.Y,a.y*Math.PI/180),h=n.RotationAxis(i.Z,a.z*Math.PI/180),u=n.RotationYawPitchRoll(a.y*Math.PI/180,a.x*Math.PI/180,a.z*Math.PI/180);t=a.toggle?a.state_notReversed?o.multiply(u):o.multiply(n.Inverse(u)):o.multiply(r).multiply(l).multiply(h),a.state_notReversed=!a.state_notReversed;this.mesh.position.y,this.mesh.position.y;this.a=e.CreateAndStartAnimation("rotate",this.mesh,"rotationQuaternion",60,60*a.duration,o,t,0,null,function(){return s.onActuateEnd()})},a.prototype.getName=function(){return"Rotator"},a.prototype.stop=function(){var t=this;null!=this.a&&(this.a.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},a.prototype.cleanUp=function(){},a.prototype.onPropertiesChange=function(){if(this.properties.autoStart){this.start(this.properties.signalId)}},a.prototype.isReady=function(){return!0},a}(t.ActuatorAbstract);t.ActuatorRotator=a}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Rotator",org.ssatguru.babylonjs.vishva.ActuatorRotator);var org;!function(t){!function(e){!function(e){!function(e){var i=t.ssatguru.babylonjs.vishva.gui.FileInputType,n=t.ssatguru.babylonjs.vishva.gui.Range,s=BABYLON.Sound,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soundFile=new i("Sounf Files",".wav$|.ogg$|.mp3$",!0),e.attachToMesh=!1,e.volume=new n(0,1,1,.1),e}return __extends(e,t),e}(e.ActProperties);e.ActSoundProp=a;var o=function(t){function e(e,i){return null!=i?t.call(this,e,i)||this:t.call(this,e,new a)||this}return __extends(e,t),e.prototype.actuate=function(){var t=this;this.properties.toggle?(this.properties.state_notReversed?this.sound.play():window.setTimeout(function(){return t.onActuateEnd()},0),this.properties.state_notReversed=!this.properties.state_notReversed):this.sound.play()},e.prototype.onPropertiesChange=function(){var t=this,e=this.properties;null!=e.soundFile.value&&(null==this.sound||e.soundFile.value!==this.sound.name?(null!=this.sound&&(this.stop(),this.sound.dispose()),this.ready=!1,this.sound=new s(e.soundFile.value,e.soundFile.value,this.mesh.getScene(),function(e){return function(){t.updateSound(e)}}(e))):(this.stop(),this.updateSound(e)))},e.prototype.updateSound=function(t){var e=this;if(this.ready=!0,t.attachToMesh&&this.sound.attachToMesh(this.mesh),this.sound.onended=function(){return e.onActuateEnd()},this.sound.setVolume(t.volume.value),t.autoStart){this.start(this.properties.signalId)||this.queued++}},e.prototype.getName=function(){return"Sound"},e.prototype.stop=function(){var t=this;null!=this.sound&&this.sound.isPlaying&&(this.sound.stop(),window.setTimeout(function(){return t.onActuateEnd()},0))},e.prototype.cleanUp=function(){},e.prototype.isReady=function(){return this.ready},e}(e.ActuatorAbstract);e.ActuatorSound=o}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addActuator("Sound",org.ssatguru.babylonjs.vishva.ActuatorSound);var org;!function(t){!function(e){!function(e){!function(e){var i=BABYLON.ActionManager,n=BABYLON.ExecuteCodeAction,s=t.ssatguru.babylonjs.vishva.gui.SelectType,a=function(t){function e(){var e=t.call(this)||this;return e.clickType=new s,e.clickType.values=["leftClick","middleClick","rightClick","doubleClick"],e.clickType.value="leftClick",e}return __extends(e,t),e}(e.SNAproperties);e.SenClickProp=a;var o=function(t){function e(e,i){var n=this;return n=null!=i?t.call(this,e,i)||this:t.call(this,e,new a)||this,n.onPropertiesChange(),n}return __extends(e,t),e.prototype.getName=function(){return"Click"},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(t){this.properties=t},e.prototype.cleanUp=function(){},e.prototype.onPropertiesChange=function(){var t=this;null==this.mesh.actionManager&&(this.mesh.actionManager=new i(this.mesh.getScene()));var e,s=this.properties;"doubleClick"==s.clickType.value?e=i.OnDoublePickTrigger:"rightClick"==s.clickType.value?e=i.OnRightPickTrigger:"leftClick"==s.clickType.value?e=i.OnLeftPickTrigger:"middleClick"==s.clickType.value&&(e=i.OnCenterPickTrigger);var a=new n(e,function(e){t.emitSignal(e)});this.mesh.actionManager.registerAction(a),this.actions.push(a)},e}(e.SensorAbstract);e.SensorClick=o}(e.vishva||(e.vishva={}))}(e.babylonjs||(e.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Click",org.ssatguru.babylonjs.vishva.SensorClick);var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.ActionManager,i=BABYLON.ExecuteCodeAction,n=BABYLON.Tags,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onEnter=!1,e.onExit=!1,e}return __extends(e,t),e}(t.SNAproperties);t.SenContactProp=s;var a=function(t){function a(e,i){var n=this;return n=null!=i?t.call(this,e,i)||this:t.call(this,e,new s)||this,n.onPropertiesChange(),n}return __extends(a,t),a.prototype.getName=function(){return"Contact"},a.prototype.getProperties=function(){return this.properties},a.prototype.setProperties=function(t){this.properties=t},a.prototype.cleanUp=function(){},a.prototype.onPropertiesChange=function(){var t=this,n=this.properties,s=this.mesh.getScene();null==this.mesh.actionManager&&(this.mesh.actionManager=new e(s));var a=s.getMeshesByTags("Vishva.avatar")[0];if(n.onEnter){var o=new i({trigger:e.OnIntersectionEnterTrigger,parameter:{mesh:a,usePreciseIntersection:!1}},function(e){return t.emitSignal(e)});this.mesh.actionManager.registerAction(o),this.actions.push(o)}if(n.onExit){var o=new i({trigger:e.OnIntersectionExitTrigger,parameter:{mesh:a,usePreciseIntersection:!1}},function(e){return t.emitSignal(e)});this.mesh.actionManager.registerAction(o),this.actions.push(o)}},a.prototype.findAV=function(t){for(var e=0;e<t.meshes.length;e++){var i=t.meshes[e];if(n.HasTags(i)&&n.MatchesQuery(i,"Vishva.avatar"))return i}return null},a}(t.SensorAbstract);t.SensorContact=a}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Contact",org.ssatguru.babylonjs.vishva.SensorContact);var org;!function(t){!function(t){!function(t){!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.interval=1e3,e.plusMinus=0,e}return __extends(e,t),e}(t.SNAproperties);t.SenTimerProp=e;var i=function(t){function i(i,n){var s=this;return s=null!=n?t.call(this,i,n)||this:t.call(this,i,new e)||this,s.onPropertiesChange(),s}return __extends(i,t),i.prototype.getName=function(){return"Timer"},i.prototype.getProperties=function(){return this.properties},i.prototype.setProperties=function(t){this.properties=t},i.prototype.cleanUp=function(){window.clearTimeout(this.timerId)},i.prototype.processUpdateSpecific_old=function(){var t=this,e=this.properties;this.timerId&&window.clearInterval(this.timerId),this.timerId=window.setInterval(function(){t.emitSignal()},e.interval)},i.prototype.onPropertiesChange=function(){var t=this,e=this.properties;this.timerId&&window.clearTimeout(this.timerId),this.timerId=window.setTimeout(function(){t.signalEmitter()},e.interval)},i.prototype.signalEmitter=function(){var t=this,e=this.properties;this.emitSignal(),window.clearTimeout(this.timerId);var i=e.interval,n=e.plusMinus;if(n>0){var s=i-n;s<0&&(s=0),i=this.getRandomInt(s,i+n)}this.timerId=window.setTimeout(function(){t.signalEmitter()},i)},i.prototype.getRandomInt=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t},i}(t.SensorAbstract);t.SensorTimer=i}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Timer",org.ssatguru.babylonjs.vishva.SensorTimer);var org;!function(t){!function(t){!function(t){!function(t){var e=BABYLON.ActionManager,i=BABYLON.ExecuteCodeAction,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.SNAproperties);t.SenTouchProp=n;var s=function(t){function s(s,a){var o=this;o=null!=a?t.call(this,s,a)||this:t.call(this,s,new n)||this,null==o.mesh.actionManager&&(o.mesh.actionManager=new e(o.mesh.getScene()));var r=new i(e.OnPickUpTrigger,function(t){0===t.sourceEvent.button&&o.emitSignal(t)});return o.mesh.actionManager.registerAction(r),o.actions.push(r),o}return __extends(s,t),s.prototype.getName=function(){return"Touch"},s.prototype.getProperties=function(){return this.properties},s.prototype.setProperties=function(t){this.properties=t},s.prototype.cleanUp=function(){},s.prototype.onPropertiesChange=function(){},s}(t.SensorAbstract);t.SensorTouch=s}(t.vishva||(t.vishva={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={})),org.ssatguru.babylonjs.vishva.SNAManager.getSNAManager().addSensor("Touch",org.ssatguru.babylonjs.vishva.SensorTouch);